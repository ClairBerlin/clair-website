import{C as E,Q as M,u as V,aj as A,c,E as S,r as F,d as s,o as n,a as b,f as p,b as t,g as u,w,t as a,x as T,i as j,e as _,F as q,p as Q,n as G,ak as H,a7 as J}from"./vendor.4e13af1e.js";import{_ as K}from"./DeletionModal.869b231e.js";import{L as P}from"./index.697ab058.js";import{_ as U}from"./SiteForm.e4ebf766.js";import"./TextInput.04a3bb8c.js";import"./camelCase.9a2aa24e.js";import"./SubmitButton.13bbed99.js";const W={key:1,class:"divide-y-2 divide-gray-300"},X={class:"max-w-sm sm:max-w-lg mt-8"},Y={class:"bg-white rounded-md shadow-md p-6"},Z={key:0,class:"text-md mt-8 pt-8"},ee={class:"text-sm text-gray-500"},te={class:"flex justify-between items-center"},se={class:"font-bold text-xl"},oe={class:"flex flex-row"},ae={class:"min-w-full divide-y divide-gray-200 ring-1 ring-gray-300 rounded-md bg-white overflow-hidden"},de={class:"bg-gray-50"},re={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},ie={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},ne=t("sup",null,"2",-1),le=_("] "),ce={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},me={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},pe={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},ue={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},he={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},_e={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},ve={class:"hidden md:table-cell px-2 sm:px-6 py-4 whitespace-nowrap text-right"},xe={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},ye={class:"flex flex-col sm:flex-row"},ge=["onClick"],we={key:1,class:"shadow-md mt-4 rounded-md max-w-sm flex items-center bg-yellow-50 border-l-4 border-yellow-400 p-4"},fe={class:"flex"},be={class:"flex-shrink-0"},je={class:"ml-3"},Le={setup($e){const{t:v}=E(),I=M(),l=V(),x=A(),$=c(()=>l.getters["nav/isOrgContextLoading"]),m=c(()=>I.params.siteId),d=c(()=>l.getters["jv/get"]({_jv:{type:"Site",id:m.value}})),k=c(()=>d.value.address._jv.id),R=c(()=>{const e=l.getters["jv/get"]("Room",`$[?(@._jv.relationships.site.data.id=="${m.value}")]`);return Object.entries(e).map(([,r])=>r)}),z=c(()=>{var e;return!$.value&&((e=R.value)==null?void 0:e.length)>0}),y=c(()=>l.getters["nav/isOwner"]),f=S(!1),g=S(),D=()=>f.value=!0,L=async()=>{console.log(`Deleting room with ID ${g.value}`),await l.dispatch("jv/delete",`rooms/${g.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Room",id:g.value}})},N=async({name:e,description:i})=>{if(d.value.name===e&&d.value.description===i)return;let r={_jv:{type:"Site",id:m.value},name:e,description:i};try{await l.dispatch("jv/patch",[r,{url:`sites/${m.value}/`}]),x.success(v("site.updateSuccess"))}catch(o){x.error(v("site.updateError")),console.log(o)}},O=async({street1:e,street2:i,zip:r,city:o})=>{if(d.value.address.street1===e&&d.value.address.street2===i&&d.value.address.zip===r&&d.value.address.city===o)return;let h={_jv:{type:"Address",id:k.value},street1:e,street2:i,zip:r,city:o};try{await l.dispatch("jv/patch",[h,{url:`addresses/${k.value}/`}]),x.success(v("address.updateSuccess"))}catch{x.error(v("address.updateError"))}},B=async({name:e,description:i,street1:r,street2:o,zip:h,city:C})=>{N({name:e,description:i}),O({street1:r,street2:o,zip:h,city:C})};return(e,i)=>{const r=F("router-link");return s($)?(n(),b(P,{key:0})):(n(),p("div",W,[t("div",X,[t("div",Y,[u(U,{"allow-edit":s(y),"site-name":s(d).name,"site-description":s(d).description,"address-street1":s(d).address.street1,"address-street2":s(d).address.street2,"address-zip":s(d).address.zip,"address-city":s(d).address.city,"button-text":"site.update","on-submit":B},null,8,["allow-edit","site-name","site-description","address-street1","address-street2","address-zip","address-city"])])]),s(z)?(n(),p("div",Z,[u(K,{open:f.value,onCloseModal:i[0]||(i[0]=o=>f.value=!1),onDeleteClicked:L,"modal-title":"delete-room-modal.title"},{default:w(()=>[t("p",ee,a(e.$t("delete-room-modal.message")),1)]),_:1},8,["open"]),t("div",te,[t("h2",se,a(e.$t("rooms"))+" "+a(e.$t("of"))+" "+a(s(d).name),1),t("div",oe,[s(y)?(n(),b(r,{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"addRoom",params:{siteId:s(m)}}},{default:w(()=>[u(s(T),{class:"w-4 h-4 mr-2"}),t("span",null,a(e.$t("room.add")),1)]),_:1},8,["to"])):j("",!0)])]),t("table",ae,[t("thead",de,[t("tr",null,[t("th",re,a(e.$t("room.name")),1),t("th",ie,[_(a(e.$t("room.size"))+" [m",1),ne,le]),t("th",ce,a(e.$t("room.height"))+" [m] ",1),t("th",me,a(e.$t("room.maxOccupancy")),1),t("th",pe,a(e.$t("action")),1)])]),t("tbody",null,[(n(!0),p(q,null,Q(s(R),(o,h)=>(n(),p("tr",{key:o._jv.id,class:G([h%2==0?"bg-white":"bg-gray-50"])},[t("td",ue,[u(r,{class:"como-link",to:{name:"room",params:{roomId:o._jv.id}}},{default:w(()=>[_(a(o.name),1)]),_:2},1032,["to"])]),t("td",he,a(o.size_sqm?e.$n(Number(o.size_sqm)):"-"),1),t("td",_e,a(o.height_m?e.$n(Number(o.height_m)):"-"),1),t("td",ve,a(o.max_occupancy||"-"),1),t("td",xe,[t("div",ye,[s(y)?(n(),p("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold",onClick:()=>{D(),g.value=o._jv.id}},[u(s(H),{class:"w-4 h-4 mr-2"}),t("span",null,a(e.$t("remove")),1)],8,ge)):j("",!0)])])],2))),128))])])])):(n(),p("div",we,[t("div",fe,[t("div",be,[u(s(J),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),t("div",je,[_(a(e.$t("site.noRooms"))+". ",1),s(y)?(n(),b(r,{key:0,class:"font-medium underline text-yellow-700 hover:text-yellow-600",to:{name:"addRoom",params:{siteId:s(m)}}},{default:w(()=>[_(a(e.$t("room.add"))+".",1)]),_:1},8,["to"])):j("",!0)])])]))]))}}};export{Le as default};
