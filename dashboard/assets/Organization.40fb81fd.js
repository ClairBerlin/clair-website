import{o as i,c as f,a as l,w as p,g as e,i as a,s as z,B as F,v as G,A as H,l as W,t as o,x as J,M as K,y as P,z as Q,b as X,C as Y,u as Z,d as x,D as ee,r as w,f as u,h as b,_ as te,E as se,G as oe,F as D,k as ae,n as ne,H as re}from"./index.5094c426.js";import{r as le}from"./index.86e5ff1d.js";import{_ as R}from"./DeletionModal.7a655758.js";import{r as ie}from"./PlusCircleIcon.503ac37a.js";import{r as B}from"./TrashIcon.f8398a48.js";function de(_,g){return i(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13l-3 3m0 0l-3-3m3 3V8m0 13a9 9 0 110-18 9 9 0 010 18z"})])}function ce(_,g){return i(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"})])}function me(_,g){return i(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})])}const ue={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},pe=e("span",{class:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"},"\u200B",-1),ge={class:"inline-block transform overflow-hidden rounded-md bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle"},he={class:"absolute top-0 right-0 hidden pt-4 pr-4 sm:block"},ve=e("span",{class:"sr-only"},"Close",-1),fe={class:"sm:flex sm:items-start"},_e={class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},ye={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},xe={class:"mt-2"},we={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},be={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","addClicked"],setup(_,{emit:g}){const r=()=>g("closeModal"),c=()=>{g("addClicked"),r()};return(d,h)=>(i(),f(a(P),{as:"template",show:_.open},{default:p(()=>[l(a(K),{as:"div",class:"fixed inset-0 z-10 overflow-y-auto",onClose:r},{default:p(()=>[e("div",ue,[l(a(z),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[l(a(F),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),pe,l(a(z),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:p(()=>[e("div",ge,[e("div",he,[e("button",{type:"button",class:"rounded-sm bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:r},[ve,l(a(G),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",fe,[e("div",_e,[l(a(ie),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",ye,[l(a(H),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:p(()=>[W(o(_.modalTitle),1)]),_:1}),e("div",xe,[J(d.$slots,"default")])])]),e("div",we,[e("button",{type:"button",class:"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",onClick:c},o(d.$t("org.addMember")),1),e("button",{type:"button",class:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm",onClick:r},o(d.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},$e={class:"border-b border-gray-200 bg-white"},ke={key:0,class:"mx-auto max-w-screen-xl px-4 pt-12 pb-4"},Me={class:""},Ce={class:"text-3xl font-bold leading-tight text-gray-900"},je={key:1,class:"mx-auto mt-4 max-w-screen-xl px-4 py-6"},Oe={class:"text-sm text-gray-500"},ze={class:"text-sm text-gray-500"},De={class:"sm:flex sm:items-center"},Re={class:"sm:flex-auto"},Be={class:"text-xl font-semibold text-gray-900"},Ie={class:"mt-2 text-sm text-gray-700"},Ee={class:"mt-4 sm:mt-0 sm:ml-16"},Te={class:"text-black"},Ae={class:"flex items-center justify-end"},Ne={class:"flex"},Se={class:"my-1 italic"},Ve={class:"form-control"},Le={class:"label px-0"},Ue={class:"label-text font-semibold"},qe={class:"mt-8 flex flex-col"},Fe={class:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8"},Ge={class:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8"},He={class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-md"},We={class:"min-w-full divide-y divide-gray-300"},Je={class:"bg-gray-50 text-sm font-medium text-gray-900"},Ke={scope:"col",class:"px-2 py-3 text-left sm:px-6"},Pe={scope:"col",class:"py-3 text-left sm:px-6"},Qe={scope:"col",class:"hidden px-2 py-3 text-left sm:px-6 md:table-cell"},Xe={scope:"col",class:"px-2 py-3 text-left"},Ye={class:"whitespace-nowrap px-2 py-4 sm:px-6"},Ze={class:"flex"},et={class:"text-sm text-gray-700"},tt={class:"whitespace-nowrap py-4 sm:px-6"},st={class:"hidden whitespace-nowrap px-2 py-4 sm:px-6 md:table-cell"},ot={class:"whitespace-nowrap px-2 py-2"},at={class:"flex flex-col sm:flex-row"},nt=["data-tip","onClick"],rt=["data-tip","onClick"],ut={setup(_){const g=Q(),r=X(),c=Y(),{t:d}=Z(),h=x(()=>r.state.nav.currentOrgId);ee(async()=>{await r.dispatch("nav/loadInvetory",h.value)});const y=x(()=>r.getters["nav/getOrgMembership"]),I=x(()=>{var t;return((t=y==null?void 0:y.value)==null?void 0:t.orgName)||"\u2026"}),E=x(()=>{var s;const t=r.getters["jv/get"]("Membership",`$[?(@.organization_name=="${(s=y==null?void 0:y.value)==null?void 0:s.orgName}")]`);return Object.entries(t).map(([,m])=>m)}),T=x(()=>r.getters["nav/isOrgContextLoading"]),$=x(()=>r.getters["nav/isOwner"]),M=w(!1),A=()=>M.value=!0,N=async()=>{console.log(`Deleting organization with ID ${h.value}`),await r.dispatch("jv/delete",`organizations/${h.value}`),r.commit("jv/deleteRecord",{_jv:{type:"Organization",id:h.value}}),await r.dispatch("authuser/fetchMemberships"),g.push({name:"org-management"})},C=w(!1),S=()=>C.value=!0,k=w(void 0),V=async()=>{console.log(`Removing member with ID ${k.value} from the organization with ID ${h.value}`),await r.dispatch("jv/delete",`memberships/${k.value}`),r.commit("jv/deleteRecord",{_jv:{type:"Membership",id:k.value}})},j=w(!1),v=w(void 0),L=async()=>{if(typeof v.value=="undefined"){c.error(d("org.noEmailError"));return}let t;try{t=await r.dispatch("jv/get",["users",{params:{"filter[search]":v.value}}])}catch(O){console.log(O),c.error(d("org.noUserWithGivenEmail")+" "+v.value),v.value=void 0;return}v.value=void 0;const n=Object.keys(t);if(typeof t=="undefined"||!t||!n[0]||(n==null?void 0:n.length)>1){c.error(d("org.unexpectedUserResult")),console.log(`Error fetching user: ${n}`);return}const s=n[0];console.log(`Adding user with ID: ${s}`);const m={_jv:{type:"Membership",role:"A",relationships:{organization:{data:{type:"Organization",id:h.value}},user:{data:{type:"User",id:s}}}}};try{await r.dispatch("jv/post",[m,{url:"memberships/"}]),await r.dispatch("jv/get",`users/${s}`),c.success(d("org.successAddMember"))}catch(O){c.error(d("org.addMemberError")),console.log(O)}},U=async t=>{const{id:n}=t._jv,s=t.role==="O"?"I":"O";try{const m={_jv:{type:"Membership",id:n},role:s};await r.dispatch("jv/patch",[m,{url:`memberships/${n}/`}]),c.success(d("role.changeSucces"))}catch(m){c.error(d("role.changeError")),console.log(m)}},q=t=>d(t==="O"?"role.downgrade":"role.upgrade");return(t,n)=>(i(),u(D,null,[e("div",$e,[t.$route.meta.title?(i(),u("header",ke,[e("div",Me,[e("h1",Ce,o(a(I))+" - "+o(t.$t("org.members")),1)])])):b("",!0)]),l(te),a(T)?(i(),f(re,{key:0})):(i(),u("div",je,[l(R,{open:M.value,onCloseModal:n[0]||(n[0]=s=>M.value=!1),onDeleteClicked:N,"modal-title":"delete-org-modal.title"},{default:p(()=>[e("p",Oe,o(t.$t("delete-org-modal.message")),1)]),_:1},8,["open"]),l(R,{open:C.value,onCloseModal:n[1]||(n[1]=s=>C.value=!1),onDeleteClicked:V,"modal-title":"remove-member-modal.title"},{default:p(()=>[e("p",ze,o(t.$t("remove-member-modal.message")),1)]),_:1},8,["open"]),e("div",De,[e("div",Re,[e("h1",Be,o(t.$t("team.title")),1),e("p",Ie,o(t.$t("team.description")),1)]),e("div",Ee,[a($)?(i(),u("div",{key:0,class:"indigo-button",onClick:n[2]||(n[2]=s=>j.value=!0)},[l(a(me),{class:"mr-2 h-4 w-4"}),e("span",null,o(t.$t("org.addMember")),1)])):b("",!0),a($)?(i(),u("div",{key:1,class:"indigo-button ml-2 bg-gray-300 text-gray-900 hover:bg-gray-400",onClick:A},[l(a(B),{class:"mr-2 h-4 w-4"}),e("span",null,o(t.$t("org.delete")),1)])):b("",!0)])]),e("div",Te,[e("div",Ae,[e("div",Ne,[l(be,{open:j.value,onCloseModal:n[4]||(n[4]=s=>j.value=!1),onAddClicked:L,"modal-title":a(d)("org.addMember")},{default:p(()=>[e("div",Se,o(t.$t("add-member-note")),1),e("div",Ve,[e("label",Le,[e("span",Ue,o(t.$t("user.email")),1)]),se(e("input",{type:"email","onUpdate:modelValue":n[3]||(n[3]=s=>v.value=s),placeholder:"name@domain.org",class:"como-focus input-bordered rounded bg-white text-gray-600"},null,512),[[oe,v.value,void 0,{trim:!0}]])])]),_:1},8,["open","modal-title"])])]),e("div",qe,[e("div",Fe,[e("div",Ge,[e("div",He,[e("table",We,[e("thead",Je,[e("tr",null,[e("th",Ke,o(t.$t("name")),1),e("th",Pe,o(t.$t("email")),1),e("th",Qe,o(t.$t("role.singular")),1),e("th",Xe,o(t.$t("actions")),1)])]),e("tbody",null,[(i(!0),u(D,null,ae(a(E),(s,m)=>(i(),u("tr",{key:s._jv.id,class:ne([m%2===0?"bg-white":"bg-gray-50"])},[e("td",Ye,[e("div",Ze,o(s.user.first_name)+" "+o(s.user.last_name),1),e("div",et,o(s.user.username),1)]),e("td",tt,o(s.user.email),1),e("td",st,o(t.$t(a(le)(s.role))),1),e("td",ot,[e("div",at,[a($)?(i(),u("div",{key:0,"data-tip":q(s.role),class:"gray-button tooltip btn-sm mr-3 w-max p-3",onClick:()=>U(s)},[(s==null?void 0:s.role)==="O"?(i(),f(a(de),{key:0,class:"h-6 w-6"})):(i(),f(a(ce),{key:1,class:"h-6 w-6"}))],8,nt)):b("",!0),a($)?(i(),u("div",{key:1,"data-tip":t.$t("remove"),class:"gray-button tooltip btn-sm bg-red-600 p-3 hover:bg-red-700",onClick:()=>{S(),k.value=s._jv.id}},[l(a(B),{class:"h-5 w-5 text-red-100"})],8,rt)):b("",!0)])])],2))),128))])])])])])])])]))],64))}};export{ut as default};
