import{a0 as E,b as F,C as z,u as A,d as u,W as D,e as H,i as s,o as r,c as f,f as d,g as e,a as h,w as g,j as P,t as a,h as I,F as W,k as G,n as J,l as v,p as K,q as C,H as M}from"./index.41107586.js";import{i as N,d as O}from"./index.3351f3ab.js";import{_ as Q}from"./RoomForm.823f26f6.js";import{_ as U}from"./PrivacyToggle.de433219.js";import"./TextInput.94d977bf.js";import"./SubmitButton.78fbcc12.js";const X={key:1},Y={class:"mt-8 max-w-sm sm:max-w-lg"},Z={class:"rounded-sm bg-white p-6 shadow-md"},tt={key:0,class:"text-md mt-8 overflow-hidden rounded-sm bg-white ring-1 ring-gray-300"},et={class:"flex items-center justify-end"},st={class:"flex flex-row"},ot={class:"min-w-full divide-y divide-gray-200"},at={class:"bg-gray-50"},nt={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},it={scope:"col",class:"py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},rt={scope:"col",class:"py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},lt={scope:"col",class:"hidden py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6 md:table-cell"},ct={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},dt={class:"whitespace-nowrap px-2 py-4 sm:px-6"},mt={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},pt={key:1},_t={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},ut={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},ht={class:"whitespace-nowrap px-2 py-4 sm:px-6"},xt={class:"flex flex-col sm:flex-row"},yt={class:"flex flex-row"},wt=["onClick"],ft={key:1,class:"mt-4 flex max-w-sm items-center rounded-sm border-l-4 border-yellow-400 bg-yellow-50 p-4 shadow-md"},gt={class:"flex"},vt={class:"flex-shrink-0"},bt={class:"ml-3"},Lt={emits:["changeSubheading"],setup(kt,{emit:L}){const R=E(),c=F(),m=z(),{t:p,n:w}=A(),b=u(()=>c.getters["nav/isOrgContextLoading"]),_=u(()=>R.params.roomId),i=u(()=>c.getters["jv/get"]({_jv:{type:"Room",id:_.value}}));D(()=>{var t;(t=i.value)!=null&&t.name&&L("changeSubheading",i.value.name)});const x=u(()=>c.getters["nav/isOwner"]),k=u(()=>{const t=c.getters["jv/get"]("Installation",`$[?(@.room._jv.id=="${_.value}")]`);return Object.entries(t).map(([,n])=>n)}),S=u(()=>{var t;return!b.value&&((t=k.value)==null?void 0:t.length)>0}),T=async({name:t,description:l,size:n,height:o,capacity:y})=>{if(i.value.name===t&&i.value.description===l&&i.value.size_sqm===n&&i.value.height_m===o&&i.value.max_occupancy===y)return;const $={_jv:{type:"Room",id:_.value},name:t,description:l,size_sqm:(n==null?void 0:n.replace(",","."))||void 0,height_m:(o==null?void 0:o.replace(",","."))||void 0,max_occupancy:y||void 0};try{await c.dispatch("jv/patch",[$,{url:`rooms/${_.value}/`}]),m.success(p("room.updateSuccess"))}catch(V){m.error(p("room.updateError")),console.log(V)}},j=async t=>{const l={_jv:{type:"Installation",id:t},to_timestamp_s:C().unix()};try{await c.dispatch("jv/patch",[l,{url:`installations/${t}/`}]),m.success(p("installation.successTerminate"))}catch(n){m.error(p("installation.errorTerminate")),console.log(n)}},q=async t=>{let l={_jv:{type:"Installation",relationships:{room:{data:{type:"Room",id:t.room._jv.id}},node:{data:{type:"Node",id:t.node._jv.id}}}},from_timestamp_s:C().unix(),to_timestamp_s:t.to_timestamp_s,is_public:!t.is_public,description:t.description};try{await c.dispatch("jv/post",[l,{url:"installations/"}]),m.success(p("installation.newInstallationCreated"))}catch(n){m.error(p("installation.errorCreatingnewInstallation")),console.log(n)}},B=async t=>{await j(t._jv.id),await q(t)};return(t,l)=>{const n=H("router-link");return s(b)?(r(),f(M,{key:0})):(r(),d("div",X,[e("div",Y,[e("div",Z,[h(Q,{"allow-edit":s(x),"room-name":s(i).name,"room-description":s(i).description,"room-size":s(w)(Number(s(i).size_sqm)),"room-height":s(w)(Number(s(i).height_m)),"room-capacity":s(w)(Number(s(i).max_occupancy)),"button-text":"update","on-submit":T},null,8,["allow-edit","room-name","room-description","room-size","room-height","room-capacity"])])]),s(S)?(r(),d("div",tt,[e("div",et,[e("div",st,[s(x)?(r(),f(n,{key:0,class:"indigo-button m-2",to:{name:"addInstallation",params:{roomId:s(_)}}},{default:g(()=>[h(s(P),{class:"mr-2 h-4 w-4"}),e("span",null,a(t.$t("installation.add")),1)]),_:1},8,["to"])):I("",!0)])]),e("table",ot,[e("thead",at,[e("tr",null,[e("th",nt,a(t.$t("room.sensor")),1),e("th",it,a(t.$t("installation.isPublic")),1),e("th",rt,a(t.$t("installation.installedOn")),1),e("th",lt,a(t.$t("installation.removedOn")),1),e("th",ct,a(t.$t("actions")),1)])]),e("tbody",null,[(r(!0),d(W,null,G(s(k),(o,y)=>(r(),d("tr",{key:o._jv.id,class:J([y%2===0?"bg-white":"bg-gray-50"])},[e("td",dt,a(o.node.alias),1),e("td",mt,[s(x)&&s(N)(o)?(r(),f(U,{key:0,enabled:o.is_public,"on-toggle":()=>B(o)},null,8,["enabled","on-toggle"])):(r(),d("div",pt,a(t.$t(`installation.public.${o.is_public}`)),1))]),e("td",_t,a(s(O)(o.from_timestamp_s)),1),e("td",ut,a(s(O)(o.to_timestamp_s)),1),e("td",ht,[e("div",xt,[e("div",yt,[h(n,{class:"gray-button btn-sm my-2 w-max font-semibold",to:{name:"installation",params:{installationId:o._jv.id}}},{default:g(()=>[v(a(t.$t("inspect")),1)]),_:2},1032,["to"])]),s(x)&&s(N)(o)?(r(),d("div",{key:0,class:"gray-button btn-sm m-2 mr-0 w-max font-semibold",onClick:$=>j(o._jv.id)},a(t.$t("installation.terminate")),9,wt)):I("",!0)])])],2))),128))])])])):(r(),d("div",ft,[e("div",gt,[e("div",vt,[h(s(K),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),e("div",bt,[v(a(t.$t("room.noInstallations"))+". "+a(" "),1),h(n,{to:{name:"addInstallation",params:{roomId:s(_)}},class:"font-medium text-yellow-700 underline hover:text-yellow-600"},{default:g(()=>[v(a(t.$t("room.addInstallation")),1)]),_:1},8,["to"])])])]))]))}}};export{Lt as default};
