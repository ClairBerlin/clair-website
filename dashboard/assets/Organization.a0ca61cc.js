import{o as i,a as O,w as m,g as r,b as e,d as a,Y as D,Z as q,_ as F,ag as G,ah as W,e as X,t as s,ai as Y,X as Z,V as H,R as J,u as K,aj as P,C as Q,c as h,E as y,f as c,i as x,ak as R,al as ee,am as te,an as se,F as T,p as oe,n as ae}from"./vendor.4e13af1e.js";import{r as ne}from"./index.3b6e3160.js";import{_ as z}from"./DeletionModal.869b231e.js";import{L as le}from"./index.697ab058.js";const re={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ie=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),de={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},ce={class:"hidden sm:block absolute top-0 right-0 pt-4 pr-4"},me=e("span",{class:"sr-only"},"Close",-1),ue={class:"sm:flex sm:items-start"},ge={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},pe={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},fe={class:"mt-2"},he={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},ve={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","addClicked"],setup($,{emit:b}){const n=()=>b("closeModal"),u=()=>{b("addClicked"),n()};return(d,p)=>(i(),O(a(H),{as:"template",show:$.open},{default:m(()=>[r(a(Z),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:n},{default:m(()=>[e("div",re,[r(a(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>[r(a(q),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),ie,r(a(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:m(()=>[e("div",de,[e("div",ce,[e("button",{type:"button",class:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:n},[me,r(a(F),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",ue,[e("div",ge,[r(a(G),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",pe,[r(a(W),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:m(()=>[X(s($.modalTitle),1)]),_:1}),e("div",fe,[Y(d.$slots,"default")])])]),e("div",he,[e("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:u},s(d.$t("org.addMember")),1),e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:n},s(d.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},ye={key:0,class:"bg-white shadow-md sm:rounded-md"},xe={class:"max-w-screen-xl px-4 py-6 mx-auto sm:px-6 lg:px-8"},be={class:"text-3xl font-bold leading-tight text-gray-900"},_e={key:2,class:"mt-8"},we={class:"text-sm text-gray-500"},$e={class:"text-sm text-gray-500"},ke={class:"text-black"},Me={class:"flex justify-end items-center"},je={class:"flex"},Ce={class:"form-control"},Oe={class:"label"},De={class:"label-text text-black font-bold"},Re={class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden"},Te={class:"min-w-full divide-y divide-gray-200"},ze={class:"bg-gray-50"},Ee={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Ie={scope:"col",class:"sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Le={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Ne={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Se={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ve={class:"flex"},Ae={class:"text-gray-700 text-sm"},Be={class:"sm:px-6 py-4 whitespace-nowrap"},Ue={class:"hidden md:table-cell px-2 sm:px-6 py-4 whitespace-nowrap"},qe={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Fe={class:"flex flex-col sm:flex-row"},Ge=["onClick"],He={setup($){const b=J(),n=K(),u=P(),{t:d}=Q(),p=h(()=>n.state.nav.currentOrgId),f=h(()=>n.getters["nav/getOrgMembership"]),E=h(()=>{var t;return((t=f==null?void 0:f.value)==null?void 0:t.orgName)||"\u2026"}),I=h(()=>{var o;const t=n.getters["jv/get"]("Membership",`$[?(@.organization_name=="${(o=f==null?void 0:f.value)==null?void 0:o.orgName}")]`);return Object.entries(t).map(([,v])=>v)}),L=h(()=>n.getters["nav/isOrgContextLoading"]),_=h(()=>n.getters["nav/isOwner"]),k=y(!1),N=()=>k.value=!0,S=async()=>{console.log(`Deleting organization with ID ${p.value}`),await n.dispatch("jv/delete",`organizations/${p.value}`),n.commit("jv/deleteRecord",{_jv:{type:"Organization",id:p.value}}),await n.dispatch("authuser/fetchMemberships"),b.push({name:"org-management"})},M=y(!1),V=()=>M.value=!0,w=y(void 0),A=async()=>{console.log(`Removing member with ID ${w.value} from the organization with ID ${p.value}`),await n.dispatch("jv/delete",`memberships/${w.value}`),n.commit("jv/deleteRecord",{_jv:{type:"Membership",id:w.value}})},j=y(!1),g=y(void 0),B=async()=>{if(typeof g.value=="undefined"){u.error(d("org.noEmailError"));return}let t;try{t=await n.dispatch("jv/get",["users",{params:{"filter[search]":g.value}}])}catch(C){console.log(C),u.error(d("org.noUserWithGivenEmail")+" "+g.value),g.value=void 0;return}g.value=void 0;const l=Object.keys(t);if(typeof t=="undefined"||!t||!l[0]||(l==null?void 0:l.length)>1){u.error(d("org.unexpectedUserResult")),console.log(`Error fetching user: ${l}`);return}const o=l[0];console.log(`Adding user with ID: ${o}`);const v={_jv:{type:"Membership",role:"A",relationships:{organization:{data:{type:"Organization",id:p.value}},user:{data:{type:"User",id:o}}}}};try{await n.dispatch("jv/post",[v,{url:"memberships/"}]),await n.dispatch("jv/get",`users/${o}`),u.success(d("org.successAddMember"))}catch(C){u.error(d("org.addMemberError")),console.log(C)}},U=()=>console.log("TODO: open modal to change role");return(t,l)=>(i(),c(T,null,[t.$route.meta.title?(i(),c("header",ye,[e("div",xe,[e("h1",be,s(t.$t("org.members"))+" "+s(t.$t("of"))+" "+s(a(E)),1)])])):x("",!0),a(L)?(i(),O(le,{key:1})):(i(),c("div",_e,[r(z,{open:k.value,onCloseModal:l[0]||(l[0]=o=>k.value=!1),onDeleteClicked:S,"modal-title":"delete-org-modal.title"},{default:m(()=>[e("p",we,s(t.$t("delete-org-modal.message")),1)]),_:1},8,["open"]),r(z,{open:M.value,onCloseModal:l[1]||(l[1]=o=>M.value=!1),onDeleteClicked:A,"modal-title":"remove-member-modal.title"},{default:m(()=>[e("p",$e,s(t.$t("remove-member-modal.message")),1)]),_:1},8,["open"]),e("div",ke,[e("div",Me,[e("div",je,[a(_)?(i(),c("div",{key:0,class:"m-2 gray-button font-semibold",onClick:N},[r(a(R),{class:"w-4 h-4 mr-2"}),e("span",null,s(t.$t("org.delete")),1)])):x("",!0),a(_)?(i(),c("div",{key:1,class:"m-2 mr-0 gray-button font-semibold",onClick:l[2]||(l[2]=o=>j.value=!0)},[r(a(ee),{class:"w-4 h-4 mr-2"}),e("span",null,s(t.$t("org.addMember")),1)])):x("",!0),r(ve,{open:j.value,onCloseModal:l[4]||(l[4]=o=>j.value=!1),onAddClicked:B,"modal-title":a(d)("org.addMember")},{default:m(()=>[e("div",Ce,[e("label",Oe,[e("span",De,s(t.$t("user.email")),1)]),te(e("input",{type:"email","onUpdate:modelValue":l[3]||(l[3]=o=>g.value=o),placeholder:"name@domain.org",class:"input-bordered como-focus rounded bg-white text-gray-600"},null,512),[[se,g.value,void 0,{trim:!0}]])])]),_:1},8,["open","modal-title"])])]),e("div",Re,[e("table",Te,[e("thead",ze,[e("tr",null,[e("th",Ee,s(t.$t("name")),1),e("th",Ie,s(t.$t("email")),1),e("th",Le,s(t.$t("role.singular")),1),e("th",Ne,s(t.$t("actions")),1)])]),e("tbody",null,[(i(!0),c(T,null,oe(a(I),(o,v)=>(i(),c("tr",{key:o._jv.id,class:ae([v%2==0?"bg-white":"bg-gray-50"])},[e("td",Se,[e("div",Ve,s(o.user.first_name)+" "+s(o.user.last_name),1),e("div",Ae,s(o.user.username),1)]),e("td",Be,s(o.user.email),1),e("td",Ue,s(t.$t(a(ne)(o.role))),1),e("td",qe,[e("div",Fe,[a(_)?(i(),c("div",{key:0,class:"btn-sm m-2 gray-button font-semibold w-max",onClick:U},s(t.$t("role.change")),1)):x("",!0),a(_)?(i(),c("div",{key:1,class:"btn-sm m-2 mr-0 gray-button font-semibold",onClick:()=>{V(),w.value=o._jv.id}},[r(a(R),{class:"w-4 h-4 mr-2"}),e("span",null,s(t.$t("remove")),1)],8,Ge)):x("",!0)])])],2))),128))])])])])]))],64))}};export{He as default};
