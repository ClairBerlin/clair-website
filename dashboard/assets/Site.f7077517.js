import{D as Z,s as H,q as J,ak as K,v as y,G as l,S as P,r as Q,o as r,c,t,a as e,al as x,am as w,u as d,g as V,d as b,w as C,e as B,y as W,b as k,F as X,l as Y,n as ee,ag as se,a7 as te}from"./vendor.eafa4657.js";import{_ as oe}from"./DeletionModal.c7a6faaa.js";const ae={key:0},de={key:1,class:"divide-y-2 divide-gray-300"},ie={class:"space-y-8 divide-y divide-gray-200"},le={class:"mt-6 sm:mt-5 space-y-6 sm:space-y-5"},re={class:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},ne={for:"site-name",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"},me={class:"mt-1 sm:mt-0 sm:col-span-2"},ce=["placeholder"],ue={class:"space-y-6 sm:space-y-5"},pe={class:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},ve={for:"description",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"},ge={class:"mt-1 sm:mt-0 sm:col-span-2"},he=["placeholder"],fe={class:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},_e={for:"street-address",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"},ye={class:"mt-1 sm:mt-0 sm:col-span-2"},xe=["placeholder"],we={class:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},be={for:"street-address2",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"},ke={class:"mt-1 sm:mt-0 sm:col-span-2"},$e=["placeholder"],je={class:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},Se={for:"postal-code",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"},Ie={class:"mt-1 sm:mt-0 sm:col-span-2"},Ve=["placeholder"],Ce={class:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},De={for:"city",class:"block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2"},Re={class:"mt-1 sm:mt-0 sm:col-span-2"},Me=["placeholder"],ze={class:"pt-5"},Oe={class:"flex justify-end"},Ue={key:0,class:"text-md mt-8 pt-8"},Be={class:"text-sm text-gray-500"},Ne={class:"flex justify-between items-center"},Fe={class:"font-bold text-xl"},Ae={class:"flex flex-row"},Ee={class:"min-w-full divide-y divide-gray-200 ring-1 ring-gray-300 rounded-md bg-white overflow-hidden"},Le={class:"bg-gray-50"},Te={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},qe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Ge=e("sup",null,"2",-1),Ze=k("] "),He={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Je={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Ke={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Pe={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Qe={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},We={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Xe={class:"hidden md:table-cell px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Ye={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},es={class:"flex flex-col sm:flex-row"},ss=["onClick"],ts={key:1,class:"shadow-md mt-4 rounded-md max-w-sm flex items-center bg-yellow-50 border-l-4 border-yellow-400 p-4"},os={class:"flex"},as={class:"flex-shrink-0"},ds={class:"ml-3"},ns={setup(is){const{t:$}=Z(),z=H(),m=J(),j=K(),i=y(()=>z.params.siteId),n=y(()=>m.getters["jv/get"]({_jv:{type:"Site",id:i.value}})),O=y(()=>n.value.address._jv.id),D=l([]),N=y(()=>{var s;return!S.value&&((s=D.value)==null?void 0:s.length)>0}),S=l(!0),R=l(!1),U=l(),F=()=>R.value=!0,A=y(()=>m.getters["authuser/getMembershipByOrgId"](z.params.orgId)),I=y(()=>{var s;return((s=A.value)==null?void 0:s.role)==="O"}),u=l(void 0),p=l(void 0),v=l(void 0),g=l(void 0),h=l(void 0),f=l(void 0),E=async()=>{await m.dispatch("jv/delete",`rooms/${U.value}`),M()},L=async()=>{let s={_jv:{type:"Site",id:i.value}};u.value&&(s.name=u.value),p.value&&(s.description=p.value);try{const{_jv:o}=await m.dispatch("jv/patch",[s,{url:`sites/${i.value}/`}]);j.success($("site.updateSuccess"))}catch(o){j.error($("site.updateError")),console.log(o)}},T=async()=>{let s={_jv:{type:"Address",id:O.value}};v.value&&(s.street1=v.value),g.value&&(s.street2=g.value),h.value&&(s.zip=h.value),f.value&&(s.city=f.value);try{const{_jv:o}=await m.dispatch("jv/patch",[s,{url:`addresses/${O.value}/`}]);j.success($("address.updateSuccess"))}catch{j.error($("address.updateError"))}},q=async()=>{(u.value||p.value)&&(L(),u.value=void 0,p.value=void 0),(v.value||g.value||h.value||f.value)&&(T(),v.value=void 0,g.value=void 0,h.value=void 0,f.value=void 0),M()},M=async()=>{var _;S.value=!0,typeof((_=n.value)==null?void 0:_.name)=="undefined"&&(console.log(`Site with ID ${i.value} has not been loaded yet; fetching...`),await m.dispatch("jv/get",`sites/${i.value}/`)),console.log(`Fetch related objects for site ${i.value}.`),await m.dispatch("jv/getRelated",`sites/${i.value}`);const s=await m.dispatch("jv/get",`sites/${i.value}/rooms`),o=Object.entries(s);console.log(`Fetched ${o.length} rooms`),D.value=o.map(([,a])=>a),S.value=!1};return P(async()=>M()),(s,o)=>{const _=Q("router-link");return S.value?(r(),c("div",ae,t(s.$t("loading...")),1)):(r(),c("div",de,[e("form",ie,[e("div",null,[e("div",le,[e("div",re,[e("label",ne,t(s.$t("site.name")),1),e("div",me,[x(e("input",{type:"text",name:"site-name",id:"site-name","onUpdate:modelValue":o[0]||(o[0]=a=>u.value=a),placeholder:d(n).name,class:"max-w-lg block w-full shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:max-w-xs sm:text-sm border-gray-300 rounded-md"},null,8,ce),[[w,u.value,void 0,{trim:!0}]])])])])]),e("div",ue,[e("div",pe,[e("label",ve,t(s.$t("description"))+" ("+t(s.$t("optional"))+") ",1),e("div",ge,[x(e("textarea",{id:"description",name:"description",rows:"3","onUpdate:modelValue":o[1]||(o[1]=a=>p.value=a),placeholder:d(n).description||"-",class:"max-w-lg shadow-sm block w-full focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border border-gray-300 rounded-md"},null,8,he),[[w,p.value,void 0,{trim:!0}]])])]),e("div",fe,[e("label",_e,t(s.$t("address.street1")),1),e("div",ye,[x(e("input",{type:"text",name:"street-address",id:"street-address",autocomplete:"street-address","onUpdate:modelValue":o[2]||(o[2]=a=>v.value=a),placeholder:d(n).address.street1,class:"block max-w-lg w-full shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border-gray-300 rounded-md"},null,8,xe),[[w,v.value,void 0,{trim:!0}]])])]),e("div",we,[e("label",be,t(s.$t("address.street2")),1),e("div",ke,[x(e("input",{type:"text",name:"street-address2",id:"street-address2","onUpdate:modelValue":o[3]||(o[3]=a=>g.value=a),placeholder:d(n).address.street2,autocomplete:"address-level4",class:"block max-w-lg w-full shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border-gray-300 rounded-md"},null,8,$e),[[w,g.value,void 0,{trim:!0}]])])]),e("div",je,[e("label",Se,t(s.$t("address.zip")),1),e("div",Ie,[x(e("input",{type:"text",name:"postal-code",id:"postal-code",autocomplete:"postal-code","onUpdate:modelValue":o[4]||(o[4]=a=>h.value=a),placeholder:d(n).address.zip,class:"max-w-lg block w-full shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:max-w-xs sm:text-sm border-gray-300 rounded-md"},null,8,Ve),[[w,h.value,void 0,{trim:!0}]])])])]),e("div",Ce,[e("label",De,t(s.$t("address.city")),1),e("div",Re,[x(e("input",{type:"text",name:"city",id:"city",autocomplete:"address-level2","onUpdate:modelValue":o[5]||(o[5]=a=>f.value=a),placeholder:d(n).address.city,class:"max-w-lg block w-full shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:max-w-xs sm:text-sm border-gray-300 rounded-md"},null,8,Me),[[w,f.value,void 0,{trim:!0}]])])]),e("div",ze,[e("div",Oe,[d(I)?(r(),c("button",{key:0,type:"submit",class:"ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:q},t(s.$t("site.update")),1)):V("",!0)])])]),d(N)?(r(),c("div",Ue,[b(oe,{open:R.value,onCloseModal:o[6]||(o[6]=a=>R.value=!1),onDeleteClicked:E,"modal-title":"delete-room-modal.title"},{default:C(()=>[e("p",Be,t(s.$t("delete-room-modal.message")),1)]),_:1},8,["open"]),e("div",Ne,[e("h2",Fe,t(s.$t("rooms"))+" "+t(s.$t("of"))+" "+t(d(n).name),1),e("div",Ae,[d(I)?(r(),B(_,{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"addRoom",params:{siteId:d(i)}}},{default:C(()=>[b(d(W),{class:"w-4 h-4 mr-2"}),e("span",null,t(s.$t("room.add")),1)]),_:1},8,["to"])):V("",!0)])]),e("table",Ee,[e("thead",Le,[e("tr",null,[e("th",Te,t(s.$t("room.name")),1),e("th",qe,[k(t(s.$t("room.size"))+" [m",1),Ge,Ze]),e("th",He,t(s.$t("room.height"))+" [m] ",1),e("th",Je,t(s.$t("room.maxOccupancy")),1),e("th",Ke,t(s.$t("action")),1)])]),e("tbody",null,[(r(!0),c(X,null,Y(D.value,(a,G)=>(r(),c("tr",{key:a._jv.id,class:ee([G%2==0?"bg-white":"bg-gray-50"])},[e("td",Pe,[b(_,{class:"como-link",to:{name:"room",params:{roomId:a._jv.id}}},{default:C(()=>[k(t(a.name),1)]),_:2},1032,["to"])]),e("td",Qe,t(a.size_sqm||"-"),1),e("td",We,t(a.height_m||"-"),1),e("td",Xe,t(a.max_occupancy||"-"),1),e("td",Ye,[e("div",es,[d(I)?(r(),c("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold",onClick:()=>{F(),U.value=a._jv.id}},[b(d(se),{class:"w-4 h-4 mr-2"}),e("span",null,t(s.$t("remove")),1)],8,ss)):V("",!0)])])],2))),128))])])])):(r(),c("div",ts,[e("div",os,[e("div",as,[b(d(te),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),e("div",ds,[k(t(s.$t("site.noRooms"))+". ",1),d(I)?(r(),B(_,{key:0,class:"font-medium underline text-yellow-700 hover:text-yellow-600",to:{name:"addRoom",params:{siteId:d(i)}}},{default:C(()=>[k(t(s.$t("room.add"))+".",1)]),_:1},8,["to"])):V("",!0)])])]))]))}}};export{ns as default};
