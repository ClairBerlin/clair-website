import{o as m,a as I,w as p,g as l,b as e,d as t,Y as O,Z as X,_ as Y,ag as Z,ah as G,e as S,t as n,ai as H,X as J,V as K,C as D,Q as W,u as ee,aj as te,c as f,E as N,r as se,f as g,am as M,a$ as ae,F as T,p as q,b0 as oe,i as L,n as ne,O as B}from"./vendor.a957619b.js";import{d as E,i as le,b as ie}from"./index.eb2dcd6d.js";import{L as re}from"./index.5e769745.js";import{s as de,c as ce,a as x,_,F as ue}from"./TextInput.d590e7a2.js";import{_ as me}from"./SubmitButton.4a79793c.js";import"./camelCase.89cf477c.js";const pe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},fe=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ge={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},be={class:"hidden sm:block absolute top-0 right-0 pt-4 pr-4"},he=e("span",{class:"sr-only"},"Close",-1),ve={class:"sm:flex sm:items-start"},ye={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},xe={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},_e={class:"mt-2"},we={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},$e={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","installClicked"],setup(i,{emit:a}){const r=()=>a("closeModal"),d=()=>{a("installClicked"),r()};return(c,w)=>(m(),I(t(K),{as:"template",show:i.open},{default:p(()=>[l(t(J),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:r},{default:p(()=>[e("div",pe,[l(t(O),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[l(t(X),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),fe,l(t(O),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:p(()=>[e("div",ge,[e("div",be,[e("button",{type:"button",class:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:r},[he,l(t(Y),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",ve,[e("div",ye,[l(t(Z),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",xe,[l(t(G),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:p(()=>[S(n(i.modalTitle),1)]),_:1}),e("div",_e,[H(c.$slots,"default")])])]),e("div",we,[e("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:d},n(c.$t("installation.installNow")),1),e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:r},n(c.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},ke={props:{sensorAlias:{type:String,default:""},sensorDescription:{type:String,default:""},eui64:{type:String,default:""},sensorId:{type:String,default:""},tradeName:{type:String,default:""},sensorManufacturer:{type:String,default:""},allowEdit:{type:Boolean,default:!1},buttonText:{type:String,required:!0},onSubmit:{type:Function,required:!0}},setup(i){const{t:a}=D();de({mixed:{required:({label:d})=>d+" "+a("field_required")},string:{max:({label:d,max:c})=>a("field_too_big",{field:d,max:c})}});const r=ce().shape({alias:x().required().max(100).label(a("node.name")),description:x().nullable().label(a("description")),eui:x().nullable().label(a("node.eui")),id:x().nullable().label(a("node.id")),type:x().nullable().label(a("node.type")),manufacturer:x().nullable().label(a("node.manufacturer"))});return(d,c)=>(m(),I(t(ue),{class:"space-y-6",onSubmit:i.onSubmit,"validation-schema":t(r)},{default:p(()=>[l(_,{disabled:!i.allowEdit,value:i.sensorAlias,name:"alias",label:t(a)("node.name")},null,8,["disabled","value","label"]),l(_,{disabled:!i.allowEdit,element:"textarea",value:i.sensorDescription,name:"description",label:`${t(a)("description")} (${t(a)("optional")})`},null,8,["disabled","value","label"]),l(_,{disabled:"",name:"eui",value:i.eui64,label:t(a)("node.eui")},null,8,["value","label"]),l(_,{disabled:"",name:"id",value:i.sensorId,label:t(a)("node.id")},null,8,["value","label"]),l(_,{disabled:"",name:"type",value:i.tradeName,label:t(a)("node.type")},null,8,["value","label"]),l(_,{disabled:"",name:"manufacturer",value:i.sensorManufacturer,label:t(a)("node.manufacturer")},null,8,["value","label"]),l(me,{"allow-submit":i.allowEdit},{default:p(()=>[S(n(d.$t(i.buttonText)),1)]),_:1},8,["allow-submit"])]),_:1},8,["onSubmit","validation-schema"]))}},je={key:0,class:""},Ce={class:"form-control"},Ie={for:"room",class:"block text-sm font-medium text-gray-700"},Se=["value"],Ne={class:"flex my-2"},Te={class:"flex items-center h-5"},Le={class:"ml-3 text-sm"},Oe={for:"makePublic",class:"font-bold text-gray-700"},De={key:2},Me={class:"max-w-sm sm:max-w-lg mt-8"},qe={class:"bg-white rounded-md shadow-md p-6"},Be={key:3,class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden mt-8"},Ee={class:"min-w-full divide-y divide-gray-200"},Ve={class:"bg-gray-50"},Ae={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Fe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Pe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Re={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},ze={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Ue={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Qe={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Xe={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Ye={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Ze={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ge={class:"flex flex-col sm:flex-row"},He={class:"flex flex-row"},Je=["onClick"],nt={setup(i){const a=W(),r=ee(),d=te(),{t:c}=D(),w=f(()=>r.getters["nav/isOwner"]),V=f(()=>r.getters["nav/isOrgContextLoading"]),h=f(()=>a.params.sensorId),v=f(()=>r.getters["jv/get"]({_jv:{type:"Node",id:h.value}})),$=f(()=>{const s=r.getters["jv/get"]("Installation",`$[?(@.node._jv.id=="${h.value}")]`);return Object.entries(s).map(([,b])=>b)}),A=f(()=>{var s;return((s=$.value)==null?void 0:s.length)>0}),F=f(()=>ie($.value)),k=f(()=>r.getters["nav/getRooms"]),P=f(()=>{var s;return((s=k.value)==null?void 0:s.length)>0}),j=N(!1),y=N(k.value[0]),C=N(!1),R=async({alias:s,description:u})=>{let b={_jv:{type:"Node",id:h.value},alias:s,description:u};try{await r.dispatch("jv/patch",[b,{url:`nodes/${h.value}/`}]),d.success(c("node.updateSuccess"))}catch(o){d.error(c("node.updateError")),console.log(o)}},z=async s=>{const u={_jv:{type:"Installation",id:s},to_timestamp_s:B().unix()};try{await r.dispatch("jv/patch",[u,{url:`installations/${s}/`}]),d.success(c("installation.successTerminate"))}catch(b){d.error(c("installation.errorTerminate")),console.log(b)}},U=async()=>{if(typeof y.value=="undefined"){d.error(c("installation.errorNoTarget"));return}let s={_jv:{type:"Installation",relationships:{room:{data:{type:"Room",id:y.value._jv.id}},node:{data:{type:"Node",id:h.value}}}},from_timestamp_s:B().unix(),is_public:C.value};try{await r.dispatch("jv/post",[s,{url:"installations/"}]),d.success(c("installation.successCreate")),y.value=void 0}catch(u){d.error(c("installation.errorCreate")),y.value=void 0,console.log(u)}};return(s,u)=>{const b=se("router-link");return m(),g(T,null,[t(w)&&!t(F)&&t(P)?(m(),g("div",je,[e("div",{class:"btn bg-indigo-600 hover:bg-indigo-700 normal-case",onClick:u[0]||(u[0]=o=>j.value=!0)},n(s.$t("installation.installNow")),1),l($e,{open:j.value,onCloseModal:u[3]||(u[3]=o=>j.value=!1),onInstallClicked:U,"modal-title":"Installation "+t(c)("of")+" "+t(v).alias},{default:p(()=>[e("div",Ce,[e("label",Ie,n(s.$t("installation.targetLocation")),1),M(e("select",{id:"location",name:"room","onUpdate:modelValue":u[1]||(u[1]=o=>y.value=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(m(!0),g(T,null,q(t(k),o=>(m(),g("option",{key:o._jv.id,value:o},n(o.name),9,Se))),128))],512),[[ae,y.value]])]),e("div",Ne,[e("div",Te,[M(e("input",{id:"makePublic",name:"makePublic",type:"checkbox","onUpdate:modelValue":u[2]||(u[2]=o=>C.value=o),class:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"},null,512),[[oe,C.value]])]),e("div",Le,[e("label",Oe,n(s.$t("installation.makePublic")),1)])])]),_:1},8,["open","modal-title"])])):L("",!0),t(V)?(m(),I(re,{key:1})):(m(),g("div",De,[e("div",Me,[e("div",qe,[l(ke,{"sensor-alias":t(v).alias,"sensor-description":t(v).description,eui64:t(v).eui64,"sensor-id":t(h),"trade-name":t(v).model.trade_name,"sensor-manufacturer":t(v).model.manufacturer,"allow-edit":t(w),"button-text":"update","on-submit":R},null,8,["sensor-alias","sensor-description","eui64","sensor-id","trade-name","sensor-manufacturer","allow-edit"])])])])),t(A)?(m(),g("div",Be,[e("table",Ee,[e("thead",Ve,[e("tr",null,[e("th",Ae,n(s.$t("node.installationLocation")),1),e("th",Fe,n(s.$t("installation.isPublic")),1),e("th",Pe,n(s.$t("installation.installedOn")),1),e("th",Re,n(s.$t("installation.removedOn")),1),e("th",ze,n(s.$t("actions")),1)])]),e("tbody",null,[(m(!0),g(T,null,q(t($),(o,Q)=>(m(),g("tr",{key:o._jv.id,class:ne([Q%2==0?"bg-white":"bg-gray-50"])},[e("td",Ue,n(o.room.name),1),e("td",Qe,n(s.$t(`installation.public.${o.is_public}`)),1),e("td",Xe,n(t(E)(o.from_timestamp_s)),1),e("td",Ye,n(t(E)(o.to_timestamp_s)),1),e("td",Ze,[e("div",Ge,[e("div",He,[l(b,{class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"installation",params:{installationId:o._jv.id}}},{default:p(()=>[S(n(s.$t("inspect")),1)]),_:2},1032,["to"])]),t(w)&&t(le)(o)?(m(),g("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:Ke=>z(o._jv.id)},n(s.$t("installation.terminate")),9,Je)):L("",!0)])])],2))),128))])])])):L("",!0)],64)}}};export{nt as default};
