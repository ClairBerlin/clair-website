import{o as r,e as O,w as p,d as m,a as t,u as o,Y as S,Z as X,_ as Y,ag as Z,ah as G,b as V,t as s,ai as H,X as J,V as K,Q as W,q as tt,aj as et,C as st,s as u,E as b,r as ot,c as d,am as k,an as D,g as $,aT as at,F as L,l as M,aU as nt,n as lt,O as P}from"./vendor.ef2875e8.js";import{d as R,i as it,b as rt}from"./index.1e325c4d.js";import{L as dt}from"./index.79af1f93.js";const ct={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},mt=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ut={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},pt={class:"hidden sm:block absolute top-0 right-0 pt-4 pr-4"},ft=t("span",{class:"sr-only"},"Close",-1),ht={class:"sm:flex sm:items-start"},_t={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},gt={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},vt={class:"mt-2"},xt={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},bt={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","installClicked"],setup(j,{emit:y}){const l=()=>y("closeModal"),c=()=>{y("installClicked"),l()};return(i,w)=>(r(),O(o(K),{as:"template",show:j.open},{default:p(()=>[m(o(J),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:l},{default:p(()=>[t("div",ct,[m(o(S),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[m(o(X),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),mt,m(o(S),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:p(()=>[t("div",ut,[t("div",pt,[t("button",{type:"button",class:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:l},[ft,m(o(Y),{class:"h-6 w-6","aria-hidden":"true"})])]),t("div",ht,[t("div",_t,[m(o(Z),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),t("div",gt,[m(o(G),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:p(()=>[V(s(j.modalTitle),1)]),_:1}),t("div",vt,[H(i.$slots,"default")])])]),t("div",xt,[t("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:c},s(i.$t("installation.installNow")),1),t("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:l},s(i.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},yt={key:1},wt={class:"max-w-sm sm:max-w-lg"},kt={class:"text-black mt-2 p-4 card rounded-md shadow-md ring-1 ring-gray-300 bg-white"},$t={class:"form-control"},jt={class:"label"},Ct={class:"label-text text-black font-bold"},It=["placeholder"],Nt={class:"form-control py-4"},Tt={class:"label"},Lt={class:"label-text text-black font-bold"},Ot=["placeholder"],St={class:"form-control"},Vt={class:"label"},Dt={class:"label-text text-black font-bold"},Mt={class:"form-control"},Pt={class:"label"},Rt={class:"label-text text-black font-bold"},At={class:"form-control"},Bt={class:"label"},Ut={class:"label-text text-black font-bold"},qt={class:"form-control"},Et={class:"label"},Ft={class:"label-text text-black font-bold"},zt={key:2,class:"mt-8"},Qt={class:"form-control"},Xt={for:"room",class:"block text-sm font-medium text-gray-700"},Yt=["value"],Zt={class:"flex my-2"},Gt={class:"flex items-center h-5"},Ht={class:"ml-3 text-sm"},Jt={for:"makePublic",class:"font-bold text-gray-700"},Kt={key:3,class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden mt-8"},Wt={class:"min-w-full divide-y divide-gray-200"},te={class:"bg-gray-50"},ee={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},se={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},oe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},ae={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},ne={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},le={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},ie={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},re={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},de={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},ce={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},me={class:"flex flex-col sm:flex-row"},ue={class:"flex flex-row"},pe=["onClick"],ve={setup(j){const y=W(),l=tt(),c=et(),{t:i}=st(),w=u(()=>l.getters["nav/isOwner"]),A=u(()=>l.getters["nav/isOrgContextLoading"]),f=u(()=>y.params.sensorId),h=u(()=>l.getters["jv/get"]({_jv:{type:"Node",id:f.value}})),C=u(()=>{const e=l.getters["jv/get"]("Installation",`$[?(@.node._jv.id=="${f.value}")]`);return Object.entries(e).map(([,x])=>x)}),B=u(()=>{var e;return((e=C.value)==null?void 0:e.length)>0}),U=u(()=>rt(C.value)),I=u(()=>l.getters["nav/getRooms"]),q=u(()=>{var e;return((e=I.value)==null?void 0:e.length)>0}),N=b(!1),g=b(void 0),v=b(void 0),_=b(I.value[0]),T=b(!1),E=async()=>{if(g.value||v.value){let e={_jv:{type:"Node",id:f.value}};g.value&&(e.alias=g.value),v.value&&(e.description=v.value);try{await l.dispatch("jv/patch",[e,{url:`nodes/${f.value}/`}]),c.success(i("node.updateSuccess"))}catch(n){c.error(i("node.updateError")),console.log(n)}}},F=async e=>{const n={_jv:{type:"Installation",id:e},to_timestamp_s:P().unix()};try{await l.dispatch("jv/patch",[n,{url:`installations/${e}/`}]),c.success(i("installation.successTerminate"))}catch(x){c.error(i("installation.errorTerminate")),console.log(x)}},z=async()=>{if(typeof _.value=="undefined"){c.error(i("installation.errorNoTarget"));return}let e={_jv:{type:"Installation",relationships:{room:{data:{type:"Room",id:_.value._jv.id}},node:{data:{type:"Node",id:f.value}}}},from_timestamp_s:P().unix(),is_public:T.value};try{await l.dispatch("jv/post",[e,{url:"installations/"}]),c.success(i("installation.successCreate")),_.value=void 0}catch(n){c.error(i("installation.errorCreate")),_.value=void 0,console.log(n)}};return(e,n)=>{const x=ot("router-link");return r(),d(L,null,[o(A)?(r(),O(dt,{key:0})):(r(),d("div",yt,[t("div",wt,[t("div",kt,[t("div",$t,[t("label",jt,[t("span",Ct,s(e.$t("node.name")),1)]),k(t("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=a=>g.value=a),placeholder:o(h).alias,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,It),[[D,g.value,void 0,{trim:!0}]])]),t("div",Nt,[t("label",Tt,[t("span",Lt,s(e.$t("description")),1)]),k(t("textarea",{type:"text","onUpdate:modelValue":n[1]||(n[1]=a=>v.value=a),placeholder:o(h).description,class:"como-focus rounded h-24 text-gray-600"},null,8,Ot),[[D,v.value,void 0,{trim:!0}]])]),o(w)?(r(),d("button",{key:0,class:"mt-2 btn gray-button font-semibold",onClick:E},s(e.$t("update")),1)):$("",!0),t("div",St,[t("label",Vt,[t("span",Dt,s(e.$t("node.eui")),1)]),t("text",null,s(o(h).eui64),1)]),t("div",Mt,[t("label",Pt,[t("span",Rt,s(e.$t("node.id")),1)]),t("text",null,s(o(f)),1)]),t("div",At,[t("label",Bt,[t("span",Ut,s(e.$t("node.type")),1)]),t("text",null,s(o(h).model.trade_name),1)]),t("div",qt,[t("label",Et,[t("span",Ft,s(e.$t("node.manufacturer")),1)]),t("text",null,s(o(h).model.manufacturer),1)])])])])),o(w)&&!o(U)&&o(q)?(r(),d("div",zt,[t("div",{class:"btn bg-indigo-600 hover:bg-indigo-700 normal-case",onClick:n[2]||(n[2]=a=>N.value=!0)},s(e.$t("installation.installNow")),1),m(bt,{open:N.value,onCloseModal:n[5]||(n[5]=a=>N.value=!1),onInstallClicked:z,"modal-title":"Installation "+o(i)("of")+" "+o(h).alias},{default:p(()=>[t("div",Qt,[t("label",Xt,s(e.$t("installation.targetLocation")),1),k(t("select",{id:"location",name:"room","onUpdate:modelValue":n[3]||(n[3]=a=>_.value=a),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(r(!0),d(L,null,M(o(I),a=>(r(),d("option",{key:a._jv.id,value:a},s(a.name),9,Yt))),128))],512),[[at,_.value]])]),t("div",Zt,[t("div",Gt,[k(t("input",{id:"makePublic",name:"makePublic",type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=a=>T.value=a),class:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"},null,512),[[nt,T.value]])]),t("div",Ht,[t("label",Jt,s(e.$t("installation.makePublic")),1)])])]),_:1},8,["open","modal-title"])])):$("",!0),o(B)?(r(),d("div",Kt,[t("table",Wt,[t("thead",te,[t("tr",null,[t("th",ee,s(e.$t("node.installationLocation")),1),t("th",se,s(e.$t("installation.isPublic")),1),t("th",oe,s(e.$t("installation.installedOn")),1),t("th",ae,s(e.$t("installation.removedOn")),1),t("th",ne,s(e.$t("actions")),1)])]),t("tbody",null,[(r(!0),d(L,null,M(o(C),(a,Q)=>(r(),d("tr",{key:a._jv.id,class:lt([Q%2==0?"bg-white":"bg-gray-50"])},[t("td",le,s(a.room.name),1),t("td",ie,s(a.is_public),1),t("td",re,s(o(R)(a.from_timestamp_s)),1),t("td",de,s(o(R)(a.to_timestamp_s)),1),t("td",ce,[t("div",me,[t("div",ue,[m(x,{class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"installation",params:{installationId:a._jv.id}}},{default:p(()=>[V(s(e.$t("inspect")),1)]),_:2},1032,["to"])]),o(w)&&o(it)(a)?(r(),d("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:fe=>F(a._jv.id)},s(e.$t("installation.terminate")),9,pe)):$("",!0)])])],2))),128))])])])):$("",!0)],64)}}};export{ve as default};
