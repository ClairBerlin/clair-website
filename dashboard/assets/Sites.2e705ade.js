import{s as O,q as C,v as m,G as y,S as V,U as z,r as B,o as a,c as i,t as s,u as h,a as t,e as N,w as g,b as l,g as b,F as k,l as R,n as E,d as w,a6 as F}from"./vendor.2f240eb0.js";const L=t("div",{class:"bg-white shadow-md p-4 rounded-md max-w-xl mx-auto"},[t("pre",null,"VIEW DESCRIPTION (will be removed)"),l(" This view will list all the sites of the selected organization, together with their adresses, and provide links to the rooms in each site. It will offer the possibility to add a new site and to remove an existing site with all its rooms and installations. ")],-1),M={key:0},P={key:1,class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden mt-8"},T={class:"flex justify-end items-center"},D={class:"flex flex-row"},q={class:"min-w-full divide-y divide-gray-200"},A={class:"bg-gray-50"},G={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},U={scope:"col",class:"sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider hidden sm:table-cell"},W={scope:"col",class:"sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},H={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},J={class:"hidden sm:table-cell px-2 sm:px-6 py-4 whitespace-nowrap"},K={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Q={class:"flex flex-col sm:flex-row"},X={class:"flex flex-row"},Y=["onClick"],Z={key:2,class:"shadow-md mt-4 rounded-md max-w-sm flex items-center bg-yellow-50 border-l-4 border-yellow-400 p-4"},ee={class:"flex"},te={class:"flex-shrink-0"},se={class:"ml-3"},ne={setup(oe){const f=O(),r=C(),x=m(()=>f.params.orgId),u=y(void 0),$=e=>`${e.street1}, ${e.zip} ${e.city}`,j=m(()=>r.getters["authuser/getMembershipByOrgId"](f.params.orgId)),v=m(()=>{var e;return((e=j.value)==null?void 0:e.role)==="O"}),S=m(()=>{var e;return((e=u.value)==null?void 0:e.length)>0}),p=y(!0),I=async e=>{await r.dispatch("jv/delete",`sites/${e}`),_()};async function _(){p.value=!0;const e=await r.dispatch("jv/get",["sites",{params:{"filter[organization]":x.value}}]),d=Object.entries(e);console.log(`Organization has ${d.length} site(s).`),u.value=d.map(([o,c])=>c);const n=d.map(([o,c])=>(console.log(`Fetch related objects for site ${o}.`),r.dispatch("jv/getRelated",`sites/${o}`)));await Promise.all(n),p.value=!1}return V(async()=>_()),z(x,()=>_()),(e,d)=>{const n=B("router-link");return a(),i(k,null,[L,p.value?(a(),i("div",M,s(e.$t("loading...")),1)):h(S)?(a(),i("div",P,[t("div",T,[t("div",D,[h(v)?(a(),N(n,{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"addSite"}},{default:g(()=>[l(s(e.$t("site.add")),1)]),_:1})):b("",!0)])]),t("table",q,[t("thead",A,[t("tr",null,[t("th",G,s(e.$t("site.name")),1),t("th",U,s(e.$t("address.singular")),1),t("th",W,s(e.$t("action")),1)])]),t("tbody",null,[(a(!0),i(k,null,R(u.value,(o,c)=>(a(),i("tr",{key:o._jv.id,class:E([c%2==0?"bg-white":"bg-gray-50"])},[t("td",H,s(o.name),1),t("td",J,s($(o.address)),1),t("td",K,[t("div",Q,[t("div",X,[w(n,{class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"site",params:{siteId:o._jv.id}}},{default:g(()=>[l(s(e.$t("inspect")),1)]),_:2},1032,["to"])]),h(v)?(a(),i("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:ae=>I(o._jv.id)},s(e.$t("remove")),9,Y)):b("",!0)])])],2))),128))])])])):(a(),i("div",Z,[t("div",ee,[t("div",te,[w(h(F),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),t("div",se,[l(s(e.$t("org.noSite"))+". ",1),w(n,{to:{name:"addSite"},class:"font-medium underline text-yellow-700 hover:text-yellow-600"},{default:g(()=>[l(s(e.$t("org.addSite"))+". ",1)]),_:1})])])]))],64)}}};export{ne as default};
