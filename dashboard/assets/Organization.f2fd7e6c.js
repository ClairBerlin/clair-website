import{o as i,e as O,w as m,d as r,a as e,u as o,Y as D,Z as q,_ as F,ag as G,ah as W,b as X,t as s,ai as Y,X as Z,V as H,R as J,q as K,aj as P,C as Q,s as h,E as v,c,g as y,ak as R,al as ee,am as te,an as se,F as T,l as oe,n as ae}from"./vendor.ef2875e8.js";import{r as ne}from"./index.1e325c4d.js";import{_ as z}from"./DeletionModal.214e9a39.js";import{L as le}from"./index.79af1f93.js";const re={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ie=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),de={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},ce={class:"hidden sm:block absolute top-0 right-0 pt-4 pr-4"},me=e("span",{class:"sr-only"},"Close",-1),ue={class:"sm:flex sm:items-start"},ge={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},pe={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},fe={class:"mt-2"},he={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},ve={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","addClicked"],setup(w,{emit:x}){const l=()=>x("closeModal"),u=()=>{x("addClicked"),l()};return(d,p)=>(i(),O(o(H),{as:"template",show:w.open},{default:m(()=>[r(o(Z),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:l},{default:m(()=>[e("div",re,[r(o(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>[r(o(q),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),ie,r(o(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:m(()=>[e("div",de,[e("div",ce,[e("button",{type:"button",class:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:l},[me,r(o(F),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",ue,[e("div",ge,[r(o(G),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",pe,[r(o(W),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:m(()=>[X(s(w.modalTitle),1)]),_:1}),e("div",fe,[Y(d.$slots,"default")])])]),e("div",he,[e("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:u},s(d.$t("org.addMember")),1),e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:l},s(d.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},ye={key:0,class:"bg-white shadow-md sm:rounded-md"},xe={class:"max-w-screen-xl px-4 py-6 mx-auto sm:px-6 lg:px-8"},be={class:"text-3xl font-bold leading-tight text-gray-900"},_e={key:2,class:"mt-8"},we={class:"text-sm text-gray-500"},$e={class:"text-sm text-gray-500"},ke={class:"text-black"},Me={class:"flex justify-end items-center"},je={class:"flex"},Ce={class:"form-control"},Oe={class:"label"},De={class:"label-text text-black font-bold"},Re={class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden"},Te={class:"min-w-full divide-y divide-gray-200"},ze={class:"bg-gray-50"},Ee={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Ie={scope:"col",class:"sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Le={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Ne={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Se={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ve={class:"flex"},Ae={class:"text-gray-700 text-sm"},Be={class:"sm:px-6 py-4 whitespace-nowrap"},Ue={class:"hidden md:table-cell px-2 sm:px-6 py-4 whitespace-nowrap"},qe={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Fe={class:"flex flex-col sm:flex-row"},Ge=["onClick"],He={setup(w){const x=J(),l=K(),u=P(),{t:d}=Q(),p=h(()=>l.state.nav.currentOrgId),f=h(()=>l.getters["nav/getOrgMembership"]),E=h(()=>(f==null?void 0:f.value.orgName)||"\u2026"),I=h(()=>{const t=l.getters["jv/get"]("Membership",`$[?(@.organization_name=="${f==null?void 0:f.value.orgName}")]`);return Object.entries(t).map(([,a])=>a)}),L=h(()=>l.getters["nav/isOrgContextLoading"]),b=h(()=>l.getters["nav/isOwner"]),$=v(!1),N=()=>$.value=!0,S=async()=>{console.log(`Deleting organization with ID ${p.value}`),await l.dispatch("jv/delete",`organizations/${p.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Organization",id:p.value}}),x.push({name:"org-management"})},k=v(!1),V=()=>k.value=!0,_=v(void 0),A=async()=>{console.log(`Removing member with ID ${_.value} from the organization with ID ${p.value}`),await l.dispatch("jv/delete",`memberships/${_.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Membership",id:_.value}})},M=v(!1),g=v(void 0),B=async()=>{if(typeof g.value=="undefined"){u.error(d("org.noEmailError"));return}let t;try{t=await l.dispatch("jv/get",["users",{params:{"filter[search]":g.value}}])}catch(C){console.log(C),u.error(d("org.noUserWithGivenEmail")+" "+g.value),g.value=void 0;return}g.value=void 0;const n=Object.keys(t);if(typeof t=="undefined"||!t||!n[0]||(n==null?void 0:n.length)>1){u.error(d("org.unexpectedUserResult")),console.log(`Error fetching user: ${n}`);return}const a=n[0];console.log(`Adding user with ID: ${a}`);const j={_jv:{type:"Membership",role:"A",relationships:{organization:{data:{type:"Organization",id:p.value}},user:{data:{type:"User",id:a}}}}};try{await l.dispatch("jv/post",[j,{url:"memberships/"}]),await l.dispatch("jv/get",`users/${a}`),u.success(d("org.successAddMember"))}catch(C){u.error(d("org.addMemberError")),console.log(C)}},U=()=>console.log("TODO: open modal to change role");return(t,n)=>(i(),c(T,null,[t.$route.meta.title?(i(),c("header",ye,[e("div",xe,[e("h1",be,s(t.$t("org.members"))+" "+s(t.$t("of"))+" "+s(o(E)),1)])])):y("",!0),o(L)?(i(),O(le,{key:1})):(i(),c("div",_e,[r(z,{open:$.value,onCloseModal:n[0]||(n[0]=a=>$.value=!1),onDeleteClicked:S,"modal-title":"delete-org-modal.title"},{default:m(()=>[e("p",we,s(t.$t("delete-org-modal.message")),1)]),_:1},8,["open"]),r(z,{open:k.value,onCloseModal:n[1]||(n[1]=a=>k.value=!1),onDeleteClicked:A,"modal-title":"remove-member-modal.title"},{default:m(()=>[e("p",$e,s(t.$t("remove-member-modal.message")),1)]),_:1},8,["open"]),e("div",ke,[e("div",Me,[e("div",je,[o(b)?(i(),c("div",{key:0,class:"m-2 gray-button font-semibold",onClick:N},[r(o(R),{class:"w-4 h-4 mr-2"}),e("span",null,s(t.$t("org.delete")),1)])):y("",!0),o(b)?(i(),c("div",{key:1,class:"m-2 mr-0 gray-button font-semibold",onClick:n[2]||(n[2]=a=>M.value=!0)},[r(o(ee),{class:"w-4 h-4 mr-2"}),e("span",null,s(t.$t("org.addMember")),1)])):y("",!0),r(ve,{open:M.value,onCloseModal:n[4]||(n[4]=a=>M.value=!1),onAddClicked:B,"modal-title":o(d)("org.addMember")},{default:m(()=>[e("div",Ce,[e("label",Oe,[e("span",De,s(t.$t("user.email")),1)]),te(e("input",{type:"email","onUpdate:modelValue":n[3]||(n[3]=a=>g.value=a),placeholder:"name@domain.org",class:"input-bordered como-focus rounded bg-white text-gray-600"},null,512),[[se,g.value,void 0,{trim:!0}]])])]),_:1},8,["open","modal-title"])])]),e("div",Re,[e("table",Te,[e("thead",ze,[e("tr",null,[e("th",Ee,s(t.$t("name")),1),e("th",Ie,s(t.$t("email")),1),e("th",Le,s(t.$t("role.singular")),1),e("th",Ne,s(t.$t("actions")),1)])]),e("tbody",null,[(i(!0),c(T,null,oe(o(I),(a,j)=>(i(),c("tr",{key:a._jv.id,class:ae([j%2==0?"bg-white":"bg-gray-50"])},[e("td",Se,[e("div",Ve,s(a.user.first_name)+" "+s(a.user.last_name),1),e("div",Ae,s(a.user.username),1)]),e("td",Be,s(a.user.email),1),e("td",Ue,s(t.$t(o(ne)(a.role))),1),e("td",qe,[e("div",Fe,[o(b)?(i(),c("div",{key:0,class:"btn-sm m-2 gray-button font-semibold w-max",onClick:U},s(t.$t("role.change")),1)):y("",!0),o(b)?(i(),c("div",{key:1,class:"btn-sm m-2 mr-0 gray-button font-semibold",onClick:()=>{V(),_.value=a._jv.id}},[r(o(R),{class:"w-4 h-4 mr-2"}),e("span",null,s(t.$t("remove")),1)],8,Ge)):y("",!0)])])],2))),128))])])])])]))],64))}};export{He as default};
