import{s as S,R as U,q as Y,ak as q,D as L,v as x,G as r,S as P,r as T,o as i,c,t as s,a as e,al as f,am as b,u as l,b as k,g as $,e as E,w as z,F as G,l as H,n as Q,d as A,Q as J}from"./vendor.eafa4657.js";const K={key:0},W={key:1},X={class:"max-w-sm sm:max-w-lg"},Z={class:"text-black mt-2 p-4 card rounded-md shadow-md ring-1 ring-gray-300 bg-white"},ee={class:"form-control"},te={class:"label"},oe={class:"label-text text-black font-bold"},se=["placeholder"],ae={class:"form-control py-4"},le={class:"label"},ne={class:"label-text text-black font-bold"},ie=["placeholder"],de={class:"form-control"},re={class:"label"},ce={class:"label-text text-black font-bold"},ue=e("sup",null,"2",-1),me=k("] "),pe=["placeholder"],he={class:"form-control"},_e={class:"label"},ve={class:"label-text text-black font-bold"},ge=["placeholder"],xe={class:"form-control"},fe={class:"label"},be={class:"label-text text-black font-bold"},ye=["placeholder"],we={key:0,class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden mt-8"},ke={class:"flex justify-end items-center"},$e={class:"flex flex-row"},je={class:"min-w-full divide-y divide-gray-200"},Re={class:"bg-gray-50"},Ie={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Ve={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Oe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},De={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Ce={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Me={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},ze={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Be={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Fe={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Ne={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Se={class:"flex flex-col sm:flex-row"},Ue={class:"flex flex-row"},Ye=["onClick"],Pe={setup(qe){const V=S();U();const d=Y(),O=q(),{t:D}=L(),n=x(()=>V.params.roomId),u=x(()=>d.getters["jv/get"]({_jv:{type:"Room",id:n.value}})),m=r(void 0),p=r(void 0),h=r(void 0),_=r(void 0),v=r(void 0),j=r([]),B=x(()=>{var t;return!y.value&&((t=j.value)==null?void 0:t.length)>0}),y=r(!0),F=x(()=>d.getters["authuser/getMembershipByOrgId"](V.params.orgId)),R=x(()=>{var t;return((t=F.value)==null?void 0:t.role)==="O"}),C=t=>t===2147483647?"\u2014":J.unix(t).format("YYYY-MM-DD"),N=async()=>{if(m.value||p.value||h.value||_.value||v.value){let t={_jv:{type:"Room",id:n.value}};m.value&&(t.name=m.value),p.value&&(t.description=p.value),h.value&&(t.size_sqm=h.value),_.value&&(t.height_m=_.value),v.value&&(t.max_occupancy=v.value);try{const{_jv:a}=await d.dispatch("jv/patch",[t,{url:`rooms/${n.value}/`}]);M(),O.success(D("room.updateSuccess"))}catch(a){O.error(D("room.updateError")),console.log(a)}}},M=async()=>{var o;y.value=!0,typeof((o=u.value)==null?void 0:o.name)=="undefined"&&(console.log(`Room with ID ${n.value} has not been loaded yet; fetching...`),await d.dispatch("jv/get",`rooms/${n.value}/`)),console.log(`Fetch related objects for room ${n.value}.`),await d.dispatch("jv/getRelated",`rooms/${n.value}`);const t=await d.dispatch("jv/get",`rooms/${n.value}/installations`),a=Object.entries(t);console.log(`Fetched ${a.length} installations`),j.value=a.map(([g,I])=>I);const w=a.map(([g,I])=>(console.log(`Get related objects for installation ${g}.`),d.dispatch("jv/getRelated",`installations/${g}`)));await Promise.all(w),y.value=!1};return P(async()=>M()),(t,a)=>{const w=T("router-link");return y.value?(i(),c("div",K,s(t.$t("loading...")),1)):(i(),c("div",W,[e("div",X,[e("div",Z,[e("div",ee,[e("label",te,[e("span",oe,s(t.$t("room.name")),1)]),f(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>m.value=o),placeholder:l(u).name,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,se),[[b,m.value,void 0,{trim:!0}]])]),e("div",ae,[e("label",le,[e("span",ne,s(t.$t("description")),1)]),f(e("textarea",{type:"text","onUpdate:modelValue":a[1]||(a[1]=o=>p.value=o),placeholder:l(u).description,class:"como-focus rounded h-24 text-gray-600"},null,8,ie),[[b,p.value,void 0,{trim:!0}]])]),e("div",de,[e("label",re,[e("span",ce,[k(s(t.$t("room.size"))+" [m",1),ue,me])]),f(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=o=>h.value=o),placeholder:l(u).size_sqm,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,pe),[[b,h.value,void 0,{trim:!0}]])]),e("div",he,[e("label",_e,[e("span",ve,s(t.$t("room.height"))+" [m] ",1)]),f(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=o=>_.value=o),placeholder:l(u).height_m,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,ge),[[b,_.value,void 0,{trim:!0}]])]),e("div",xe,[e("label",fe,[e("span",be,s(t.$t("room.maxOccupancy")),1)]),f(e("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=o=>v.value=o),placeholder:l(u).max_occupancy,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,ye),[[b,v.value,void 0,{trim:!0}]])]),l(R)?(i(),c("button",{key:0,class:"mt-2 btn gray-button font-semibold",onClick:N},s(t.$t("update")),1)):$("",!0)])]),l(B)?(i(),c("div",we,[e("div",ke,[e("div",$e,[l(R)?(i(),E(w,{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"addInstallation",params:{roomId:l(n)}}},{default:z(()=>[k(s(t.$t("installation.add")),1)]),_:1},8,["to"])):$("",!0)])]),e("table",je,[e("thead",Re,[e("tr",null,[e("th",Ie,s(t.$t("room.sensor")),1),e("th",Ve,s(t.$t("node.isPublic")),1),e("th",Oe,s(t.$t("node.installedOn")),1),e("th",De,s(t.$t("node.removedOn")),1),e("th",Ce,s(t.$t("actions")),1)])]),e("tbody",null,[(i(!0),c(G,null,H(j.value,(o,g)=>(i(),c("tr",{key:o._jv.id,class:Q([g%2==0?"bg-white":"bg-gray-50"])},[e("td",Me,s(o.node.alias),1),e("td",ze,s(o.is_public),1),e("td",Be,s(C(o.from_timestamp_s)),1),e("td",Fe,s(C(o.to_timestamp_s)),1),e("td",Ne,[e("div",Se,[e("div",Ue,[A(w,{class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"installation",params:{installationId:o._jv.id}}},{default:z(()=>[k(s(t.$t("inspect")),1)]),_:2},1032,["to"])]),l(R)?(i(),c("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:I=>t.terminateInstallation(o._jv.id)},s(t.$t("installation.terminate")),9,Ye)):$("",!0)])])],2))),128))])])])):$("",!0)]))}}};export{Pe as default};
