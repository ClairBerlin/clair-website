import{o as d,a as $,w as p,g as r,b as e,d as a,X as D,_ as G,Z as F,ak as Q,ai as W,e as Y,t as o,aj as X,W as Z,Y as H,V as J,u as K,al as P,D as ee,c as v,Q as te,G as _,f as u,j as y,am as se,an as R,ao as oe,ap as ae,F as I,q as ne,n as le,aq as re,ar as ie}from"./vendor.c632a9d3.js";import{r as de}from"./index.ce7b7c95.js";import{_ as z}from"./DeletionModal.8e0bf4a3.js";import{_ as ce,a as me}from"./index.36f78768.js";const ue={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},pe=e("span",{class:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"},"\u200B",-1),ge={class:"inline-block transform overflow-hidden rounded-md bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle"},he={class:"absolute top-0 right-0 hidden pt-4 pr-4 sm:block"},fe=e("span",{class:"sr-only"},"Close",-1),ve={class:"sm:flex sm:items-start"},_e={class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},ye={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},xe={class:"mt-2"},be={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},we={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","addClicked"],setup(k,{emit:x}){const l=()=>x("closeModal"),c=()=>{x("addClicked"),l()};return(i,g)=>(d(),$(a(H),{as:"template",show:k.open},{default:p(()=>[r(a(Z),{as:"div",class:"fixed inset-0 z-10 overflow-y-auto",onClose:l},{default:p(()=>[e("div",ue,[r(a(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[r(a(G),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),pe,r(a(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:p(()=>[e("div",ge,[e("div",he,[e("button",{type:"button",class:"rounded-sm bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:l},[fe,r(a(F),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",ve,[e("div",_e,[r(a(Q),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",ye,[r(a(W),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:p(()=>[Y(o(k.modalTitle),1)]),_:1}),e("div",xe,[X(i.$slots,"default")])])]),e("div",be,[e("button",{type:"button",class:"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",onClick:c},o(i.$t("org.addMember")),1),e("button",{type:"button",class:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm",onClick:l},o(i.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},$e={class:"border-b border-gray-200 bg-white"},ke={key:0,class:"mx-auto max-w-screen-xl px-4 pt-12 pb-4"},Me={class:""},je={class:"text-3xl font-bold leading-tight text-gray-900"},Ce={key:1,class:"mx-auto mt-4 max-w-screen-xl px-4 py-6"},Oe={class:"text-sm text-gray-500"},De={class:"text-sm text-gray-500"},Re={class:"sm:flex sm:items-center"},Ie={class:"sm:flex-auto"},ze={class:"text-xl font-semibold text-gray-900"},Ee={class:"mt-2 text-sm text-gray-700"},Te={class:"mt-4 sm:mt-0 sm:ml-16"},Ne={class:"text-black"},Se={class:"flex items-center justify-end"},Ve={class:"flex"},qe={class:"my-1 italic"},Ae={class:"form-control"},Be={class:"label px-0"},Le={class:"label-text font-semibold"},Ue={class:"mt-8 flex flex-col"},Ge={class:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8"},Fe={class:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8"},Qe={class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-md"},We={class:"min-w-full divide-y divide-gray-300"},Ye={class:"bg-gray-50 text-sm font-medium text-gray-900"},Xe={scope:"col",class:"px-2 py-3 text-left sm:px-6"},Ze={scope:"col",class:"py-3 text-left sm:px-6"},He={scope:"col",class:"hidden px-2 py-3 text-left sm:px-6 md:table-cell"},Je={scope:"col",class:"px-2 py-3 text-left"},Ke={class:"whitespace-nowrap px-2 py-4 sm:px-6"},Pe={class:"flex"},et={class:"text-sm text-gray-700"},tt={class:"whitespace-nowrap py-4 sm:px-6"},st={class:"hidden whitespace-nowrap px-2 py-4 sm:px-6 md:table-cell"},ot={class:"whitespace-nowrap px-2 py-2"},at={class:"flex flex-col sm:flex-row"},nt=["data-tip","onClick"],lt=["data-tip","onClick"],mt={setup(k){const x=J(),l=K(),c=P(),{t:i}=ee(),g=v(()=>l.state.nav.currentOrgId);te(async()=>{await l.dispatch("nav/loadInvetory",g.value)});const f=v(()=>l.getters["nav/getOrgMembership"]),E=v(()=>{var t;return((t=f==null?void 0:f.value)==null?void 0:t.orgName)||"\u2026"}),T=v(()=>{var s;const t=l.getters["jv/get"]("Membership",`$[?(@.organization_name=="${(s=f==null?void 0:f.value)==null?void 0:s.orgName}")]`);return Object.entries(t).map(([,m])=>m)}),N=v(()=>l.getters["nav/isOrgContextLoading"]),b=v(()=>l.getters["nav/isOwner"]),M=_(!1),S=()=>M.value=!0,V=async()=>{console.log(`Deleting organization with ID ${g.value}`),await l.dispatch("jv/delete",`organizations/${g.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Organization",id:g.value}}),await l.dispatch("authuser/fetchMemberships"),x.push({name:"org-management"})},j=_(!1),q=()=>j.value=!0,w=_(void 0),A=async()=>{console.log(`Removing member with ID ${w.value} from the organization with ID ${g.value}`),await l.dispatch("jv/delete",`memberships/${w.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Membership",id:w.value}})},C=_(!1),h=_(void 0),B=async()=>{if(typeof h.value=="undefined"){c.error(i("org.noEmailError"));return}let t;try{t=await l.dispatch("jv/get",["users",{params:{"filter[search]":h.value}}])}catch(O){console.log(O),c.error(i("org.noUserWithGivenEmail")+" "+h.value),h.value=void 0;return}h.value=void 0;const n=Object.keys(t);if(typeof t=="undefined"||!t||!n[0]||(n==null?void 0:n.length)>1){c.error(i("org.unexpectedUserResult")),console.log(`Error fetching user: ${n}`);return}const s=n[0];console.log(`Adding user with ID: ${s}`);const m={_jv:{type:"Membership",role:"A",relationships:{organization:{data:{type:"Organization",id:g.value}},user:{data:{type:"User",id:s}}}}};try{await l.dispatch("jv/post",[m,{url:"memberships/"}]),await l.dispatch("jv/get",`users/${s}`),c.success(i("org.successAddMember"))}catch(O){c.error(i("org.addMemberError")),console.log(O)}},L=async t=>{const{id:n}=t._jv,s=t.role==="O"?"I":"O";try{const m={_jv:{type:"Membership",id:n},role:s};await l.dispatch("jv/patch",[m,{url:`memberships/${n}/`}]),c.success(i("role.changeSucces"))}catch(m){c.error(i("role.changeError")),console.log(m)}},U=t=>i(t==="O"?"role.downgrade":"role.upgrade");return(t,n)=>(d(),u(I,null,[e("div",$e,[t.$route.meta.title?(d(),u("header",ke,[e("div",Me,[e("h1",je,o(a(E))+" - "+o(t.$t("org.members")),1)])])):y("",!0)]),r(ce),a(N)?(d(),$(me,{key:0})):(d(),u("div",Ce,[r(z,{open:M.value,onCloseModal:n[0]||(n[0]=s=>M.value=!1),onDeleteClicked:V,"modal-title":"delete-org-modal.title"},{default:p(()=>[e("p",Oe,o(t.$t("delete-org-modal.message")),1)]),_:1},8,["open"]),r(z,{open:j.value,onCloseModal:n[1]||(n[1]=s=>j.value=!1),onDeleteClicked:A,"modal-title":"remove-member-modal.title"},{default:p(()=>[e("p",De,o(t.$t("remove-member-modal.message")),1)]),_:1},8,["open"]),e("div",Re,[e("div",Ie,[e("h1",ze,o(t.$t("team.title")),1),e("p",Ee,o(t.$t("team.description")),1)]),e("div",Te,[a(b)?(d(),u("div",{key:0,class:"indigo-button",onClick:n[2]||(n[2]=s=>C.value=!0)},[r(a(se),{class:"mr-2 h-4 w-4"}),e("span",null,o(t.$t("org.addMember")),1)])):y("",!0),a(b)?(d(),u("div",{key:1,class:"indigo-button ml-2 bg-gray-300 text-gray-900 hover:bg-gray-400",onClick:S},[r(a(R),{class:"mr-2 h-4 w-4"}),e("span",null,o(t.$t("org.delete")),1)])):y("",!0)])]),e("div",Ne,[e("div",Se,[e("div",Ve,[r(we,{open:C.value,onCloseModal:n[4]||(n[4]=s=>C.value=!1),onAddClicked:B,"modal-title":a(i)("org.addMember")},{default:p(()=>[e("div",qe,o(t.$t("add-member-note")),1),e("div",Ae,[e("label",Be,[e("span",Le,o(t.$t("user.email")),1)]),oe(e("input",{type:"email","onUpdate:modelValue":n[3]||(n[3]=s=>h.value=s),placeholder:"name@domain.org",class:"como-focus input-bordered rounded bg-white text-gray-600"},null,512),[[ae,h.value,void 0,{trim:!0}]])])]),_:1},8,["open","modal-title"])])]),e("div",Ue,[e("div",Ge,[e("div",Fe,[e("div",Qe,[e("table",We,[e("thead",Ye,[e("tr",null,[e("th",Xe,o(t.$t("name")),1),e("th",Ze,o(t.$t("email")),1),e("th",He,o(t.$t("role.singular")),1),e("th",Je,o(t.$t("actions")),1)])]),e("tbody",null,[(d(!0),u(I,null,ne(a(T),(s,m)=>(d(),u("tr",{key:s._jv.id,class:le([m%2===0?"bg-white":"bg-gray-50"])},[e("td",Ke,[e("div",Pe,o(s.user.first_name)+" "+o(s.user.last_name),1),e("div",et,o(s.user.username),1)]),e("td",tt,o(s.user.email),1),e("td",st,o(t.$t(a(de)(s.role))),1),e("td",ot,[e("div",at,[a(b)?(d(),u("div",{key:0,"data-tip":U(s.role),class:"gray-button tooltip btn-sm mr-3 w-max p-3",onClick:()=>L(s)},[(s==null?void 0:s.role)==="O"?(d(),$(a(re),{key:0,class:"h-6 w-6"})):(d(),$(a(ie),{key:1,class:"h-6 w-6"}))],8,nt)):y("",!0),a(b)?(d(),u("div",{key:1,"data-tip":t.$t("remove"),class:"gray-button tooltip btn-sm bg-red-600 p-3 hover:bg-red-700",onClick:()=>{q(),w.value=s._jv.id}},[r(a(R),{class:"h-5 w-5 text-red-100"})],8,lt)):y("",!0)])])],2))),128))])])])])])])])]))],64))}};export{mt as default};
