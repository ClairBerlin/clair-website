import{s as B,q as D,v as u,G as p,S as I,U as V,r as z,o,c as n,t as s,u as i,d as r,w as h,a as t,e as N,y as F,g as k,F as L,l as R,n as P,b as y,ag as q,a7 as A}from"./vendor.eafa4657.js";import{_ as E}from"./DeletionModal.c7a6faaa.js";const G={key:0},T={key:1,class:"text-md mt-8"},U={class:"text-sm text-gray-500"},H={class:"flex justify-end items-center"},J={class:"flex flex-row"},K={class:"overflow-hidden rounded-md ring-1 ring-gray-300 bg-white min-w-full divide-y divide-gray-200"},Q={class:"bg-gray-50"},W={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},X={scope:"col",class:"sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider hidden sm:table-cell"},Y={scope:"col",class:"sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Z={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},ee={class:"hidden sm:table-cell px-2 sm:px-6 py-4 whitespace-nowrap"},te={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},se={class:"flex flex-col sm:flex-row"},ae=t("div",{class:"flex flex-row"},null,-1),oe=["onClick"],le={key:2,class:"shadow-md mt-4 rounded-md max-w-sm flex items-center bg-yellow-50 border-l-4 border-yellow-400 p-4"},ne={class:"flex"},ie={class:"flex-shrink-0"},re={class:"ml-3"},ue={setup(de){const w=B(),c=D(),x=u(()=>w.params.orgId),_=p(void 0),g=p(!1),b=p(),j=()=>g.value=!0,S=e=>`${e.street1}, ${e.zip} ${e.city}`,C=u(()=>c.getters["authuser/getMembershipByOrgId"](w.params.orgId)),$=u(()=>{var e;return((e=C.value)==null?void 0:e.role)==="O"}),M=u(()=>{var e;return((e=_.value)==null?void 0:e.length)>0}),f=p(!0),O=async()=>{await c.dispatch("jv/delete",`sites/${b.value}`),v()};async function v(){f.value=!0;const e=await c.dispatch("jv/get",["sites",{params:{"filter[organization]":x.value}}]),l=Object.entries(e);console.log(`Organization has ${l.length} site(s).`),_.value=l.map(([a,m])=>m);const d=l.map(([a,m])=>(console.log(`Fetch related objects for site ${a}.`),c.dispatch("jv/getRelated",`sites/${a}`)));await Promise.all(d),f.value=!1}return I(async()=>v()),V(x,()=>v()),(e,l)=>{const d=z("router-link");return f.value?(o(),n("div",G,s(e.$t("loading...")),1)):i(M)?(o(),n("div",T,[r(E,{open:g.value,onCloseModal:l[0]||(l[0]=a=>g.value=!1),onDeleteClicked:O,"modal-title":"delete-site-modal.title"},{default:h(()=>[t("p",U,s(e.$t("delete-site-modal.message")),1)]),_:1},8,["open"]),t("div",H,[t("div",J,[i($)?(o(),N(d,{key:0,class:"m-2 mr-0 gray-button font-semibold",to:{name:"addSite"}},{default:h(()=>[r(i(F),{class:"w-4 h-4 mr-2"}),t("span",null,s(e.$t("site.add")),1)]),_:1})):k("",!0)])]),t("table",K,[t("thead",Q,[t("tr",null,[t("th",W,s(e.$t("site.name")),1),t("th",X,s(e.$t("address.singular")),1),t("th",Y,s(e.$t("action")),1)])]),t("tbody",null,[(o(!0),n(L,null,R(_.value,(a,m)=>(o(),n("tr",{key:a._jv.id,class:P([m%2==0?"bg-white":"bg-gray-50"])},[t("td",Z,[r(d,{class:"como-link",to:{name:"site",params:{siteId:a._jv.id}}},{default:h(()=>[y(s(a.name),1)]),_:2},1032,["to"])]),t("td",ee,s(S(a.address)),1),t("td",te,[t("div",se,[ae,i($)?(o(),n("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:()=>{j(),b.value=a._jv.id}},[r(i(q),{class:"w-4 h-4 mr-2"}),t("span",null,s(e.$t("remove")),1)],8,oe)):k("",!0)])])],2))),128))])])])):(o(),n("div",le,[t("div",ne,[t("div",ie,[r(i(A),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),t("div",re,[y(s(e.$t("org.noSite"))+". ",1),r(d,{to:{name:"addSite"},class:"font-medium underline text-yellow-700 hover:text-yellow-600"},{default:h(()=>[y(s(e.$t("org.addSite"))+". ",1)]),_:1})])])]))}}};export{ue as default};
