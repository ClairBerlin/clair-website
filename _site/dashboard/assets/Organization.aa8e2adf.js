import{o as i,a as $,w as g,g as d,b as e,d as o,Y as D,Z as F,_ as G,ag as W,ah as X,e as Y,t as n,ai as Z,X as H,V as J,R as K,u as P,aj as Q,C as ee,c as y,E as x,f as u,i as f,ak as R,al as te,am as se,an as oe,F as I,p as ae,n as ne,ao as le,ap as re}from"./vendor.2e3a8e12.js";import{r as ie}from"./index.6ae68e35.js";import{_ as T}from"./DeletionModal.001ca0cc.js";import{L as de}from"./index.09f868a8.js";const ce={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},me=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ue={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},ge={class:"hidden sm:block absolute top-0 right-0 pt-4 pr-4"},pe=e("span",{class:"sr-only"},"Close",-1),fe={class:"sm:flex sm:items-start"},he={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},ve={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},ye={class:"mt-2"},xe={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},_e={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","addClicked"],setup(k,{emit:_}){const l=()=>_("closeModal"),c=()=>{_("addClicked"),l()};return(r,h)=>(i(),$(o(J),{as:"template",show:k.open},{default:g(()=>[d(o(H),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:l},{default:g(()=>[e("div",ce,[d(o(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:g(()=>[d(o(F),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),me,d(o(D),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:g(()=>[e("div",ue,[e("div",ge,[e("button",{type:"button",class:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:l},[pe,d(o(G),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",fe,[e("div",he,[d(o(W),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",ve,[d(o(X),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:g(()=>[Y(n(k.modalTitle),1)]),_:1}),e("div",ye,[Z(r.$slots,"default")])])]),e("div",xe,[e("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:c},n(r.$t("org.addMember")),1),e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:l},n(r.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},we={key:0,class:"bg-white shadow-md sm:rounded-md"},be={class:"max-w-screen-xl px-4 py-6 mx-auto sm:px-6 lg:px-8"},$e={class:"text-3xl font-bold leading-tight text-gray-900"},ke={key:2,class:"mt-8"},Me={class:"text-sm text-gray-500"},je={class:"text-sm text-gray-500"},Ce={class:"text-black"},Oe={class:"flex justify-end items-center"},De={class:"flex"},Re={class:"form-control"},Ie={class:"label"},Te={class:"label-text text-black font-bold"},ze={class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden"},Ee={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-gray-50"},Ne={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Se={scope:"col",class:"sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Ve={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Ae={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Be={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ue={class:"flex"},qe={class:"text-gray-700 text-sm"},Fe={class:"sm:px-6 py-4 whitespace-nowrap"},Ge={class:"hidden md:table-cell px-2 sm:px-6 py-4 whitespace-nowrap"},We={class:"px-4 py-4 whitespace-nowrap"},Xe={class:"flex flex-col sm:flex-row"},Ye=["data-tip","onClick"],Ze=["data-tip","onClick"],Qe={setup(k){const _=K(),l=P(),c=Q(),{t:r}=ee(),h=y(()=>l.state.nav.currentOrgId),v=y(()=>l.getters["nav/getOrgMembership"]),z=y(()=>{var s;return((s=v==null?void 0:v.value)==null?void 0:s.orgName)||"\u2026"}),E=y(()=>{var t;const s=l.getters["jv/get"]("Membership",`$[?(@.organization_name=="${(t=v==null?void 0:v.value)==null?void 0:t.orgName}")]`);return Object.entries(s).map(([,m])=>m)}),L=y(()=>l.getters["nav/isOrgContextLoading"]),w=y(()=>l.getters["nav/isOwner"]),M=x(!1),N=()=>M.value=!0,S=async()=>{console.log(`Deleting organization with ID ${h.value}`),await l.dispatch("jv/delete",`organizations/${h.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Organization",id:h.value}}),await l.dispatch("authuser/fetchMemberships"),_.push({name:"org-management"})},j=x(!1),V=()=>j.value=!0,b=x(void 0),A=async()=>{console.log(`Removing member with ID ${b.value} from the organization with ID ${h.value}`),await l.dispatch("jv/delete",`memberships/${b.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Membership",id:b.value}})},C=x(!1),p=x(void 0),B=async()=>{if(typeof p.value=="undefined"){c.error(r("org.noEmailError"));return}let s;try{s=await l.dispatch("jv/get",["users",{params:{"filter[search]":p.value}}])}catch(O){console.log(O),c.error(r("org.noUserWithGivenEmail")+" "+p.value),p.value=void 0;return}p.value=void 0;const a=Object.keys(s);if(typeof s=="undefined"||!s||!a[0]||(a==null?void 0:a.length)>1){c.error(r("org.unexpectedUserResult")),console.log(`Error fetching user: ${a}`);return}const t=a[0];console.log(`Adding user with ID: ${t}`);const m={_jv:{type:"Membership",role:"A",relationships:{organization:{data:{type:"Organization",id:h.value}},user:{data:{type:"User",id:t}}}}};try{await l.dispatch("jv/post",[m,{url:"memberships/"}]),await l.dispatch("jv/get",`users/${t}`),c.success(r("org.successAddMember"))}catch(O){c.error(r("org.addMemberError")),console.log(O)}},U=async s=>{const{id:a}=s._jv,t=s.role==="O"?"I":"O";try{const m={_jv:{type:"Membership",id:a},role:t};await l.dispatch("jv/patch",[m,{url:`memberships/${a}/`}]),c.success(r("role.changeSucces"))}catch(m){c.error(r("role.changeError")),console.log(m)}},q=s=>r(s==="I"?"role.upgrade":"role.downgrade");return(s,a)=>(i(),u(I,null,[s.$route.meta.title?(i(),u("header",we,[e("div",be,[e("h1",$e,n(s.$t("org.members"))+" "+n(s.$t("of"))+" "+n(o(z)),1)])])):f("",!0),o(L)?(i(),$(de,{key:1})):(i(),u("div",ke,[d(T,{open:M.value,onCloseModal:a[0]||(a[0]=t=>M.value=!1),onDeleteClicked:S,"modal-title":"delete-org-modal.title"},{default:g(()=>[e("p",Me,n(s.$t("delete-org-modal.message")),1)]),_:1},8,["open"]),d(T,{open:j.value,onCloseModal:a[1]||(a[1]=t=>j.value=!1),onDeleteClicked:A,"modal-title":"remove-member-modal.title"},{default:g(()=>[e("p",je,n(s.$t("remove-member-modal.message")),1)]),_:1},8,["open"]),e("div",Ce,[e("div",Oe,[e("div",De,[o(w)?(i(),u("div",{key:0,class:"m-2 gray-button font-semibold",onClick:N},[d(o(R),{class:"w-4 h-4 mr-2"}),e("span",null,n(s.$t("org.delete")),1)])):f("",!0),o(w)?(i(),u("div",{key:1,class:"m-2 mr-0 gray-button font-semibold",onClick:a[2]||(a[2]=t=>C.value=!0)},[d(o(te),{class:"w-4 h-4 mr-2"}),e("span",null,n(s.$t("org.addMember")),1)])):f("",!0),d(_e,{open:C.value,onCloseModal:a[4]||(a[4]=t=>C.value=!1),onAddClicked:B,"modal-title":o(r)("org.addMember")},{default:g(()=>[e("div",Re,[e("label",Ie,[e("span",Te,n(s.$t("user.email")),1)]),se(e("input",{type:"email","onUpdate:modelValue":a[3]||(a[3]=t=>p.value=t),placeholder:"name@domain.org",class:"input-bordered como-focus rounded bg-white text-gray-600"},null,512),[[oe,p.value,void 0,{trim:!0}]])])]),_:1},8,["open","modal-title"])])]),e("div",ze,[e("table",Ee,[e("thead",Le,[e("tr",null,[e("th",Ne,n(s.$t("name")),1),e("th",Se,n(s.$t("email")),1),e("th",Ve,n(s.$t("role.singular")),1),e("th",Ae,n(s.$t("actions")),1)])]),e("tbody",null,[(i(!0),u(I,null,ae(o(E),(t,m)=>(i(),u("tr",{key:t._jv.id,class:ne([m%2==0?"bg-white":"bg-gray-50"])},[e("td",Be,[e("div",Ue,n(t.user.first_name)+" "+n(t.user.last_name),1),e("div",qe,n(t.user.username),1)]),e("td",Fe,n(t.user.email),1),e("td",Ge,n(s.$t(o(ie)(t.role))),1),e("td",We,[e("div",Xe,[o(w)?(i(),u("div",{key:0,"data-tip":q(t.role),class:"btn-sm m-2 gray-button font-semibold w-max tooltip",onClick:()=>U(t)},[(t==null?void 0:t.role)==="O"?(i(),$(o(le),{key:0,class:"w-5 h-5"})):f("",!0),(t==null?void 0:t.role)==="I"?(i(),$(o(re),{key:1,class:"w-5 h-5"})):f("",!0)],8,Ye)):f("",!0),o(w)?(i(),u("div",{key:1,"data-tip":s.$t("remove"),class:"btn-sm tooltip m-2 mr-0 gray-button bg-red-600 hover:bg-red-700",onClick:()=>{V(),b.value=t._jv.id}},[d(o(R),{class:"w-4 h-4 text-red-100"})],8,Ze)):f("",!0)])])],2))),128))])])])])]))],64))}};export{Qe as default};
