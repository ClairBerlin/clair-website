import{U as q,u as B,al as R,D as V,c as m,H as E,r as F,d as s,o as r,a as $,f as p,b as e,g as x,w,e as y,t as o,j,F as D,q as z,n as A,a8 as H,O as P}from"./vendor.ac9c094a.js";import{d as I,i as U}from"./index.5e76fa27.js";import{L as G}from"./index.f9f485b8.js";import{_ as J}from"./RoomForm.dc5b12e6.js";import"./TextInput.cb06f71d.js";import"./SubmitButton.b4a43348.js";const K={key:1},M={class:"mt-8 max-w-sm sm:max-w-lg"},Q={class:"rounded-sm bg-white p-6 shadow-md"},W={key:0,class:"text-md mt-8 overflow-hidden rounded-sm bg-white ring-1 ring-gray-300"},X={class:"flex items-center justify-end"},Y={class:"flex flex-row"},Z={class:"min-w-full divide-y divide-gray-200"},tt={class:"bg-gray-50"},et={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},st={scope:"col",class:"py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},ot={scope:"col",class:"py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},at={scope:"col",class:"hidden py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6 md:table-cell"},nt={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},it={class:"whitespace-nowrap px-2 py-4 sm:px-6"},rt={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},lt={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},ct={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},dt={class:"whitespace-nowrap px-2 py-4 sm:px-6"},mt={class:"flex flex-col sm:flex-row"},pt={class:"flex flex-row"},ut=["onClick"],_t={key:1,class:"mt-4 flex max-w-sm items-center rounded-sm border-l-4 border-yellow-400 bg-yellow-50 p-4 shadow-md"},ht={class:"flex"},xt={class:"flex-shrink-0"},yt={class:"ml-3"},jt={emits:["changeSubheading"],setup(ft,{emit:O}){const C=q(),l=B(),u=R(),{t:_,n:f}=V(),g=m(()=>l.getters["nav/isOrgContextLoading"]),c=m(()=>C.params.roomId),n=m(()=>l.getters["jv/get"]({_jv:{type:"Room",id:c.value}}));E(()=>{var t;((t=n.value)==null?void 0:t.name)&&O("changeSubheading",n.value.name)});const v=m(()=>l.getters["nav/isOwner"]),b=m(()=>{const t=l.getters["jv/get"]("Installation",`$[?(@.room._jv.id=="${c.value}")]`);return Object.entries(t).map(([,i])=>i)}),L=m(()=>{var t;return!g.value&&((t=b.value)==null?void 0:t.length)>0}),N=async({name:t,description:d,size:i,height:a,capacity:h})=>{if(n.value.name===t&&n.value.description===d&&n.value.size_sqm===i&&n.value.height_m===a&&n.value.max_occupancy===h)return;const k={_jv:{type:"Room",id:c.value},name:t,description:d,size_sqm:(i==null?void 0:i.replace(",","."))||void 0,height_m:(a==null?void 0:a.replace(",","."))||void 0,max_occupancy:h||void 0};try{await l.dispatch("jv/patch",[k,{url:`rooms/${c.value}/`}]),u.success(_("room.updateSuccess"))}catch(T){u.error(_("room.updateError")),console.log(T)}},S=async t=>{const d={_jv:{type:"Installation",id:t},to_timestamp_s:P().unix()};try{await l.dispatch("jv/patch",[d,{url:`installations/${t}/`}]),u.success(_("installation.successTerminate"))}catch(i){u.error(_("installation.errorTerminate")),console.log(i)}};return(t,d)=>{const i=F("router-link");return s(g)?(r(),$(G,{key:0})):(r(),p("div",K,[e("div",M,[e("div",Q,[x(J,{"allow-edit":s(v),"room-name":s(n).name,"room-description":s(n).description,"room-size":s(f)(Number(s(n).size_sqm)),"room-height":s(f)(Number(s(n).height_m)),"room-capacity":s(f)(Number(s(n).max_occupancy)),"button-text":"update","on-submit":N},null,8,["allow-edit","room-name","room-description","room-size","room-height","room-capacity"])])]),s(L)?(r(),p("div",W,[e("div",X,[e("div",Y,[s(v)?(r(),$(i,{key:0,class:"gray-button btn-sm m-2 mr-0 w-max font-semibold",to:{name:"addInstallation",params:{roomId:s(c)}}},{default:w(()=>[y(o(t.$t("installation.add")),1)]),_:1},8,["to"])):j("",!0)])]),e("table",Z,[e("thead",tt,[e("tr",null,[e("th",et,o(t.$t("room.sensor")),1),e("th",st,o(t.$t("installation.isPublic")),1),e("th",ot,o(t.$t("installation.installedOn")),1),e("th",at,o(t.$t("installation.removedOn")),1),e("th",nt,o(t.$t("actions")),1)])]),e("tbody",null,[(r(!0),p(D,null,z(s(b),(a,h)=>(r(),p("tr",{key:a._jv.id,class:A([h%2===0?"bg-white":"bg-gray-50"])},[e("td",it,o(a.node.alias),1),e("td",rt,o(t.$t(`installation.public.${a.is_public}`)),1),e("td",lt,o(s(I)(a.from_timestamp_s)),1),e("td",ct,o(s(I)(a.to_timestamp_s)),1),e("td",dt,[e("div",mt,[e("div",pt,[x(i,{class:"gray-button btn-sm my-2 w-max font-semibold",to:{name:"installation",params:{installationId:a._jv.id}}},{default:w(()=>[y(o(t.$t("inspect")),1)]),_:2},1032,["to"])]),s(v)&&s(U)(a)?(r(),p("div",{key:0,class:"gray-button btn-sm m-2 mr-0 w-max font-semibold",onClick:k=>S(a._jv.id)},o(t.$t("installation.terminate")),9,ut)):j("",!0)])])],2))),128))])])])):(r(),p("div",_t,[e("div",ht,[e("div",xt,[x(s(H),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),e("div",yt,[y(o(t.$t("room.noInstallations"))+". "+o(" "),1),x(i,{to:{name:"addInstallation",params:{roomId:s(c)}},class:"font-medium text-yellow-700 underline hover:text-yellow-600"},{default:w(()=>[y(o(t.$t("room.addInstallation")),1)]),_:1},8,["to"])])])]))]))}}};export{jt as default};
