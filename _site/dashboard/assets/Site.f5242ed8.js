import{o as r,c as b,a as m,u as P,a0 as W,b as H,C as U,d as h,W as G,r as O,e as J,i as t,f as p,g as e,t as a,p as L,w as f,j as K,h as j,l as u,F as Q,k as X,n as Y,H as Z}from"./index.73c24b0d.js";import{_ as ee}from"./DeletionModal.44059589.js";import{_ as se}from"./SiteForm.6249820e.js";import{r as te}from"./TrashIcon.d9645363.js";import"./TextInput.7c6478b9.js";import"./SubmitButton.89a62278.js";function oe(B,C){return r(),b("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}const ae={key:1,class:"divide-y-2 divide-gray-300"},ie={class:"mt-8 flex flex-col gap-4 lg:flex-row"},de={class:"max-w-sm sm:max-w-lg lg:min-w-[50%]"},ne={class:"rounded-sm bg-white p-6 shadow-md"},re={class:"flex max-w-lg flex-col gap-4"},le={class:"rounded-lg bg-indigo-100 p-4 shadow-sm"},ce={class:"flex"},me={class:"flex-shrink-0"},pe={class:"ml-3 max-w-md flex-1 md:flex"},ue={class:"text-sm text-indigo-900"},he={class:"w-auto"},_e={class:"mockup-code relative rounded-lg bg-indigo-200 px-2 text-indigo-900 shadow-sm"},ge=u("        "),ve=u(`
        `),xe=u(`
        `),we={class:"pb-1 text-xl font-bold"},ye=["src"],fe={key:1,class:"mt-4 flex items-center rounded-lg border-l-4 border-yellow-400 bg-yellow-50 p-4 shadow-sm"},be={class:"flex"},$e={class:"flex-shrink-0"},ke={class:"ml-3"},je={key:0,class:"text-md mt-8 pt-8"},Ce={class:"text-sm text-gray-500"},Ie={class:"flex items-center justify-between"},Re={class:"text-xl font-bold"},Se={class:"flex flex-row"},ze={class:"min-w-full divide-y divide-gray-200 overflow-hidden rounded-sm bg-white ring-1 ring-gray-300"},Oe={class:"bg-gray-50"},Le={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},Be={scope:"col",class:"py-3 text-right text-xs font-medium tracking-wider text-gray-500 sm:px-6"},De=e("sup",null,"2",-1),Ne=u("] "),Me={scope:"col",class:"py-3 text-right text-xs font-medium tracking-wider text-gray-500 sm:px-6"},Ee={scope:"col",class:"hidden py-3 text-right text-xs font-medium tracking-wider text-gray-500 sm:px-6 md:table-cell"},Te={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},Ve={class:"whitespace-nowrap px-2 py-4 sm:px-6"},Ae={class:"whitespace-nowrap px-2 py-4 text-right sm:px-6"},qe={class:"whitespace-nowrap px-2 py-4 text-right sm:px-6"},Fe={class:"hidden whitespace-nowrap px-2 py-4 text-right sm:px-6 md:table-cell"},Pe={class:"whitespace-nowrap px-2 py-4 sm:px-6"},We={class:"flex flex-col sm:flex-row"},He=["onClick"],Ue={key:1,class:"mt-4 flex max-w-sm items-center rounded-sm border-l-4 border-yellow-400 bg-yellow-50 p-4 shadow-md"},Ge={class:"flex"},Je={class:"flex-shrink-0"},Ke={class:"ml-3"},ts={emits:["changeSubheading"],setup(B,{emit:C}){const{t:_}=P(),D=W(),l=H(),g=U(),I=h(()=>l.getters["nav/isOrgContextLoading"]),c=h(()=>D.params.siteId),i=h(()=>l.getters["jv/get"]({_jv:{type:"Site",id:c.value}}));G(()=>{var s;(s=i.value)!=null&&s.name&&C("changeSubheading",i.value.name)});const R=h(()=>i.value.address._jv.id),$=h(()=>{const s=l.getters["jv/get"]("Room",`$[?(@._jv.relationships.site.data.id=="${c.value}")]`);return Object.entries(s).map(([,d])=>d)}),N=h(()=>{var s;return!I.value&&((s=$.value)==null?void 0:s.length)>0}),x=h(()=>l.getters["nav/isOwner"]),k=O(!1),w=O(),M=()=>k.value=!0,E=async()=>{console.log(`Deleting room with ID ${w.value}`),await l.dispatch("jv/delete",`rooms/${w.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Room",id:w.value}})},T=async({name:s,description:n})=>{if(i.value.name===s&&i.value.description===n)return;let d={_jv:{type:"Site",id:c.value},name:s,description:n};try{await l.dispatch("jv/patch",[d,{url:`sites/${c.value}/`}]),g.success(_("site.updateSuccess"))}catch(o){g.error(_("site.updateError")),console.log(o)}},V=async({street1:s,street2:n,zip:d,city:o})=>{if(i.value.address.street1===s&&i.value.address.street2===n&&i.value.address.zip===d&&i.value.address.city===o)return;let v={_jv:{type:"Address",id:R.value},street1:s,street2:n,zip:d,city:o};try{await l.dispatch("jv/patch",[v,{url:`addresses/${R.value}/`}]),g.success(_("address.updateSuccess"))}catch{g.error(_("address.updateError"))}},A=async({name:s,description:n,street1:d,street2:o,zip:v,city:y})=>{T({name:s,description:n}),V({street1:d,street2:o,zip:v,city:y})},S=s=>`https://como-berlin.de/embed/${s}`,z=s=>`<iframe
  src="${S(s)}"
  width="359px"
  height="620px"
></iframe>`,q=()=>$.value.map(d=>{const o=l.getters["jv/get"]("Installation",`$[?(@.room._jv.id=="${d._jv.id}")]`);return Object.entries(o).map(([,y])=>y)}).map(d=>d.some(o=>o.is_public)).some(Boolean),F=async()=>{try{await navigator.clipboard.writeText(z(c.value)),g.success(_("copy.success"))}catch{g.error(_("copy.failure"))}};return(s,n)=>{const d=J("router-link");return t(I)?(r(),b(Z,{key:0})):(r(),p("div",ae,[e("div",ie,[e("div",de,[e("div",ne,[m(se,{"allow-edit":t(x),"site-name":t(i).name,"site-description":t(i).description,"address-street1":t(i).address.street1,"address-street2":t(i).address.street2,"address-zip":t(i).address.zip,"address-city":t(i).address.city,"button-text":"site.update","on-submit":A},null,8,["allow-edit","site-name","site-description","address-street1","address-street2","address-zip","address-city"])])]),e("div",re,[e("div",le,[e("div",ce,[e("div",me,[m(t(oe),{class:"h-5 w-5 text-indigo-600","aria-hidden":"true"})]),e("div",pe,[e("p",ue,a(s.$t("snippet.text")),1)])])]),e("div",he,[e("pre",_e,[ge,e("code",null,`
`+a(z(t(c)))+`
        `,1),ve,e("button",{type:"button",class:"absolute bottom-0 right-0 m-2 p-2 pb-1 cursor-pointer rounded-md hover:bg-indigo-100 bg-indigo-50",onClick:n[0]||(n[0]=o=>F())},a(s.$t("copy.action")),1),xe])]),e("div",null,[e("h2",we,a(s.$t("preview")),1),q()?(r(),p("iframe",{key:0,class:"overflow-hidden rounded-lg bg-white shadow-sm",src:S(t(c)),width:"359px",height:"620px"},null,8,ye)):(r(),p("div",fe,[e("div",be,[e("div",$e,[m(t(L),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),e("div",ke,a(s.$t("snippet.noPreview")),1)])]))])])]),t(N)?(r(),p("div",je,[m(ee,{open:k.value,onCloseModal:n[1]||(n[1]=o=>k.value=!1),onDeleteClicked:E,"modal-title":"delete-room-modal.title"},{default:f(()=>[e("p",Ce,a(s.$t("delete-room-modal.message")),1)]),_:1},8,["open"]),e("div",Ie,[e("h2",Re,a(s.$t("rooms"))+" "+a(s.$t("of"))+" "+a(t(i).name),1),e("div",Se,[t(x)?(r(),b(d,{key:0,class:"gray-button btn-sm m-2 mr-0 w-max font-semibold",to:{name:"addRoom",params:{siteId:t(c)}}},{default:f(()=>[m(t(K),{class:"mr-2 h-4 w-4"}),e("span",null,a(s.$t("room.add")),1)]),_:1},8,["to"])):j("",!0)])]),e("table",ze,[e("thead",Oe,[e("tr",null,[e("th",Le,a(s.$t("room.name")),1),e("th",Be,[u(a(s.$t("room.size"))+" [m",1),De,Ne]),e("th",Me,a(s.$t("room.height"))+" [m] ",1),e("th",Ee,a(s.$t("room.maxOccupancy")),1),e("th",Te,a(s.$t("action")),1)])]),e("tbody",null,[(r(!0),p(Q,null,X(t($),(o,v)=>(r(),p("tr",{key:o._jv.id,class:Y([v%2===0?"bg-white":"bg-gray-50"])},[e("td",Ve,[m(d,{class:"como-link",to:{name:"room",params:{roomId:o._jv.id}}},{default:f(()=>[u(a(o.name),1)]),_:2},1032,["to"])]),e("td",Ae,a(o.size_sqm?s.$n(Number(o.size_sqm)):"-"),1),e("td",qe,a(o.height_m?s.$n(Number(o.height_m)):"-"),1),e("td",Fe,a(o.max_occupancy||"-"),1),e("td",Pe,[e("div",We,[t(x)?(r(),p("div",{key:0,class:"gray-button btn-sm m-2 mr-0 font-semibold",onClick:()=>{M(),w.value=o._jv.id}},[m(t(te),{class:"mr-2 h-4 w-4"}),e("span",null,a(s.$t("remove")),1)],8,He)):j("",!0)])])],2))),128))])])])):(r(),p("div",Ue,[e("div",Ge,[e("div",Je,[m(t(L),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),e("div",Ke,[u(a(s.$t("site.noRooms"))+". ",1),t(x)?(r(),b(d,{key:0,class:"font-medium text-yellow-700 underline hover:text-yellow-600",to:{name:"addRoom",params:{siteId:t(c)}}},{default:f(()=>[u(a(s.$t("room.add"))+".",1)]),_:1},8,["to"])):j("",!0)])])]))]))}}};export{ts as default};
