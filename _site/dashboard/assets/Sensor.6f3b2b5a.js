import{o as m,a as I,w as p,g as l,b as e,d as t,Y as O,Z as Q,_ as X,ag as Y,ah as Z,e as S,t as n,ai as G,X as H,V as J,C as V,Q as K,u as W,aj as ee,c as f,E as N,r as te,f as g,am as se,a$ as ae,F as T,p as D,i as L,n as oe,O as q}from"./vendor.4e13af1e.js";import{d as B,i as ne,b as le}from"./index.3b6e3160.js";import{L as ie}from"./index.697ab058.js";import{s as re,c as de,a as x,_,F as ce}from"./TextInput.04a3bb8c.js";import{_ as ue}from"./SubmitButton.13bbed99.js";import{_ as me}from"./PrivacyToggle.9f09cf88.js";import"./camelCase.9a2aa24e.js";const pe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},fe=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ge={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},be={class:"hidden sm:block absolute top-0 right-0 pt-4 pr-4"},ve=e("span",{class:"sr-only"},"Close",-1),he={class:"sm:flex sm:items-start"},ye={class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},xe={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},_e={class:"mt-2"},we={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},$e={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","installClicked"],setup(i,{emit:a}){const r=()=>a("closeModal"),d=()=>{a("installClicked"),r()};return(c,w)=>(m(),I(t(J),{as:"template",show:i.open},{default:p(()=>[l(t(H),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:r},{default:p(()=>[e("div",pe,[l(t(O),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[l(t(Q),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),fe,l(t(O),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:p(()=>[e("div",ge,[e("div",be,[e("button",{type:"button",class:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:r},[ve,l(t(X),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",he,[e("div",ye,[l(t(Y),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",xe,[l(t(Z),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:p(()=>[S(n(i.modalTitle),1)]),_:1}),e("div",_e,[G(c.$slots,"default")])])]),e("div",we,[e("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:d},n(c.$t("installation.installNow")),1),e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:r},n(c.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},ke={props:{sensorAlias:{type:String,default:""},sensorDescription:{type:String,default:""},eui64:{type:String,default:""},sensorId:{type:String,default:""},tradeName:{type:String,default:""},sensorManufacturer:{type:String,default:""},allowEdit:{type:Boolean,default:!1},buttonText:{type:String,required:!0},onSubmit:{type:Function,required:!0}},setup(i){const{t:a}=V();re({mixed:{required:({label:d})=>d+" "+a("field_required")},string:{max:({label:d,max:c})=>a("field_too_big",{field:d,max:c})}});const r=de().shape({alias:x().required().max(100).label(a("node.name")),description:x().nullable().label(a("description")),eui:x().nullable().label(a("node.eui")),id:x().nullable().label(a("node.id")),type:x().nullable().label(a("node.type")),manufacturer:x().nullable().label(a("node.manufacturer"))});return(d,c)=>(m(),I(t(ce),{class:"space-y-6",onSubmit:i.onSubmit,"validation-schema":t(r)},{default:p(()=>[l(_,{disabled:!i.allowEdit,value:i.sensorAlias,name:"alias",label:t(a)("node.name")},null,8,["disabled","value","label"]),l(_,{disabled:!i.allowEdit,element:"textarea",value:i.sensorDescription,name:"description",label:`${t(a)("description")} (${t(a)("optional")})`},null,8,["disabled","value","label"]),l(_,{disabled:"",name:"eui",value:i.eui64,label:t(a)("node.eui")},null,8,["value","label"]),l(_,{disabled:"",name:"id",value:i.sensorId,label:t(a)("node.id")},null,8,["value","label"]),l(_,{disabled:"",name:"type",value:i.tradeName,label:t(a)("node.type")},null,8,["value","label"]),l(_,{disabled:"",name:"manufacturer",value:i.sensorManufacturer,label:t(a)("node.manufacturer")},null,8,["value","label"]),l(ue,{"allow-submit":i.allowEdit},{default:p(()=>[S(n(d.$t(i.buttonText)),1)]),_:1},8,["allow-submit"])]),_:1},8,["onSubmit","validation-schema"]))}},je={key:0,class:""},Ce={class:"form-control"},Ie={for:"room",class:"block text-sm font-medium text-gray-700"},Se=["value"],Ne={class:"flex items-center my-2"},Te={class:"mr-3 text-sm"},Le={for:"makePublic",class:"font-medium text-gray-700"},Oe={key:2},Ve={class:"max-w-sm sm:max-w-lg mt-8"},De={class:"bg-white rounded-md shadow-md p-6"},qe={key:3,class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden mt-8"},Be={class:"min-w-full divide-y divide-gray-200"},Ee={class:"bg-gray-50"},Me={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Ae={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Fe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Re={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Pe={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},ze={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ue={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Qe={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Xe={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Ye={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ze={class:"flex flex-col sm:flex-row"},Ge={class:"flex flex-row"},He=["onClick"],nt={setup(i){const a=K(),r=W(),d=ee(),{t:c}=V(),w=f(()=>r.getters["nav/isOwner"]),E=f(()=>r.getters["nav/isOrgContextLoading"]),v=f(()=>a.params.sensorId),h=f(()=>r.getters["jv/get"]({_jv:{type:"Node",id:v.value}})),$=f(()=>{const s=r.getters["jv/get"]("Installation",`$[?(@.node._jv.id=="${v.value}")]`);return Object.entries(s).map(([,b])=>b)}),M=f(()=>{var s;return((s=$.value)==null?void 0:s.length)>0}),A=f(()=>le($.value)),k=f(()=>r.getters["nav/getRooms"]),F=f(()=>{var s;return((s=k.value)==null?void 0:s.length)>0}),j=N(!1),y=N(k.value[0]),C=N(!1),R=async({alias:s,description:u})=>{let b={_jv:{type:"Node",id:v.value},alias:s,description:u};try{await r.dispatch("jv/patch",[b,{url:`nodes/${v.value}/`}]),d.success(c("node.updateSuccess"))}catch(o){d.error(c("node.updateError")),console.log(o)}},P=async s=>{const u={_jv:{type:"Installation",id:s},to_timestamp_s:q().unix()};try{await r.dispatch("jv/patch",[u,{url:`installations/${s}/`}]),d.success(c("installation.successTerminate"))}catch(b){d.error(c("installation.errorTerminate")),console.log(b)}},z=async()=>{if(typeof y.value=="undefined"){d.error(c("installation.errorNoTarget"));return}let s={_jv:{type:"Installation",relationships:{room:{data:{type:"Room",id:y.value._jv.id}},node:{data:{type:"Node",id:v.value}}}},from_timestamp_s:q().unix(),is_public:C.value};try{await r.dispatch("jv/post",[s,{url:"installations/"}]),d.success(c("installation.successCreate")),y.value=void 0}catch(u){d.error(c("installation.errorCreate")),y.value=void 0,console.log(u)}};return(s,u)=>{const b=te("router-link");return m(),g(T,null,[t(w)&&!t(A)&&t(F)?(m(),g("div",je,[e("div",{class:"btn bg-indigo-600 hover:bg-indigo-700 normal-case",onClick:u[0]||(u[0]=o=>j.value=!0)},n(s.$t("installation.installNow")),1),l($e,{open:j.value,onCloseModal:u[3]||(u[3]=o=>j.value=!1),onInstallClicked:z,"modal-title":"Installation "+t(c)("of")+" "+t(h).alias},{default:p(()=>[e("div",Ce,[e("label",Ie,n(s.$t("installation.targetLocation")),1),se(e("select",{id:"location",name:"room","onUpdate:modelValue":u[1]||(u[1]=o=>y.value=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(m(!0),g(T,null,D(t(k),o=>(m(),g("option",{key:o._jv.id,value:o},n(o.name),9,Se))),128))],512),[[ae,y.value]])]),e("div",Ne,[e("div",Te,[e("label",Le,n(s.$t("installation.makePublic")),1)]),e("div",null,[l(me,{modelValue:C.value,"onUpdate:modelValue":u[2]||(u[2]=o=>C.value=o)},null,8,["modelValue"])])])]),_:1},8,["open","modal-title"])])):L("",!0),t(E)?(m(),I(ie,{key:1})):(m(),g("div",Oe,[e("div",Ve,[e("div",De,[l(ke,{"sensor-alias":t(h).alias,"sensor-description":t(h).description,eui64:t(h).eui64,"sensor-id":t(v),"trade-name":t(h).model.trade_name,"sensor-manufacturer":t(h).model.manufacturer,"allow-edit":t(w),"button-text":"update","on-submit":R},null,8,["sensor-alias","sensor-description","eui64","sensor-id","trade-name","sensor-manufacturer","allow-edit"])])])])),t(M)?(m(),g("div",qe,[e("table",Be,[e("thead",Ee,[e("tr",null,[e("th",Me,n(s.$t("node.installationLocation")),1),e("th",Ae,n(s.$t("installation.isPublic")),1),e("th",Fe,n(s.$t("installation.installedOn")),1),e("th",Re,n(s.$t("installation.removedOn")),1),e("th",Pe,n(s.$t("actions")),1)])]),e("tbody",null,[(m(!0),g(T,null,D(t($),(o,U)=>(m(),g("tr",{key:o._jv.id,class:oe([U%2==0?"bg-white":"bg-gray-50"])},[e("td",ze,n(o.room.name),1),e("td",Ue,n(s.$t(`installation.public.${o.is_public}`)),1),e("td",Qe,n(t(B)(o.from_timestamp_s)),1),e("td",Xe,n(t(B)(o.to_timestamp_s)),1),e("td",Ye,[e("div",Ze,[e("div",Ge,[l(b,{class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"installation",params:{installationId:o._jv.id}}},{default:p(()=>[S(n(s.$t("inspect")),1)]),_:2},1032,["to"])]),t(w)&&t(ne)(o)?(m(),g("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:Je=>P(o._jv.id)},n(s.$t("installation.terminate")),9,He)):L("",!0)])])],2))),128))])])])):L("",!0)],64)}}};export{nt as default};
