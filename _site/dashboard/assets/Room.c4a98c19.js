import{s as T,R as U,q as E,ah as P,D as Y,v as x,G as c,S as q,r as L,o as i,c as d,t as s,a as e,ai as b,aj as f,u as l,b as y,g as $,e as G,w as C,F as M,l as H,n as Q,d as W,Q as A}from"./vendor.2f240eb0.js";const J=e("div",{class:"bg-white shadow-md p-4 rounded-md max-w-xl mx-auto"},[e("pre",null,"VIEW DESCRIPTION (will be removed)"),y(" This sub-view will detail information on the selected room an allow the user to update it; e.g., name, description, size, max. occupancy, etc. In addition, this view provides means to add and remove sensor installations in the selected room. ")],-1),K={key:0},X={key:1},Z={class:"max-w-sm sm:max-w-lg"},ee={class:"text-black m-2 p-4 card ring-1 ring-gray-300 bg-white"},te={class:"form-control"},oe={class:"label"},se={class:"label-text text-black font-bold"},ae=["placeholder"],le={class:"form-control py-4"},ne={class:"label"},ie={class:"label-text text-black font-bold"},de=["placeholder"],re={class:"form-control"},ce={class:"label"},me={class:"label-text text-black font-bold"},ue=e("sup",null,"2",-1),pe=y("] "),he=["placeholder"],_e={class:"form-control"},ve={class:"label"},ge={class:"label-text text-black font-bold"},xe=["placeholder"],be={class:"form-control"},fe={class:"label"},ye={class:"label-text text-black font-bold"},we=["placeholder"],ke={key:0,class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden mt-8"},$e={class:"flex justify-end items-center"},je={class:"flex flex-row"},Re={class:"min-w-full divide-y divide-gray-200"},Ie={class:"bg-gray-50"},Ve={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Oe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},De={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Ce={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Me={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},ze={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ne={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Be={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Fe={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Se={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Te={class:"flex flex-col sm:flex-row"},Ue={class:"flex flex-row"},Ee=["onClick"],qe={setup(Pe){const V=T();U();const r=E(),z=P(),N=Y(),n=x(()=>V.params.roomId),m=x(()=>r.getters["jv/get"]({_jv:{type:"Room",id:n.value}})),u=c(void 0),p=c(void 0),h=c(void 0),_=c(void 0),v=c(void 0),j=c([]),B=x(()=>{var t;return!w.value&&((t=j.value)==null?void 0:t.length)>0}),w=c(!0),F=x(()=>r.getters["authuser/getMembershipByOrgId"](V.params.orgId)),R=x(()=>{var t;return((t=F.value)==null?void 0:t.role)==="O"}),O=t=>t===2147483647?"\u2014":A.unix(t).format("YYYY-MM-DD"),S=async()=>{if(u.value||p.value||h.value||_.value||v.value){let t={_jv:{type:"Room",id:n.value}};u.value&&(t.name=u.value),p.value&&(t.description=p.value),h.value&&(t.size_sqm=h.value),_.value&&(t.height_m=_.value),v.value&&(t.max_occupancy=v.value);try{const{_jv:a}=await r.dispatch("jv/patch",[t,{url:`rooms/${n.value}/`}]);D()}catch(a){z.error(N("room.updateError")),console.log(a)}}},D=async()=>{var o;w.value=!0,typeof((o=m.value)==null?void 0:o.name)=="undefined"&&(console.log(`Room with ID ${n.value} has not been loaded yet; fetching...`),await r.dispatch("jv/get",`rooms/${n.value}/`)),console.log(`Fetch related objects for room ${n.value}.`),await r.dispatch("jv/getRelated",`rooms/${n.value}`);const t=await r.dispatch("jv/get",`rooms/${n.value}/installations`),a=Object.entries(t);console.log(`Fetched ${a.length} installations`),j.value=a.map(([g,I])=>I);const k=a.map(([g,I])=>(console.log(`Get related objects for installation ${g}.`),r.dispatch("jv/getRelated",`installations/${g}`)));await Promise.all(k),w.value=!1};return q(async()=>D()),(t,a)=>{const k=L("router-link");return i(),d(M,null,[J,w.value?(i(),d("div",K,s(t.$t("loading...")),1)):(i(),d("div",X,[e("div",Z,[e("div",ee,[e("div",te,[e("label",oe,[e("span",se,s(t.$t("room.name")),1)]),b(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>u.value=o),placeholder:l(m).name,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,ae),[[f,u.value,void 0,{trim:!0}]])]),e("div",le,[e("label",ne,[e("span",ie,s(t.$t("description")),1)]),b(e("textarea",{type:"text","onUpdate:modelValue":a[1]||(a[1]=o=>p.value=o),placeholder:l(m).description,class:"como-focus rounded h-24 text-gray-600"},null,8,de),[[f,p.value,void 0,{trim:!0}]])]),e("div",re,[e("label",ce,[e("span",me,[y(s(t.$t("room.size"))+" [m",1),ue,pe])]),b(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=o=>h.value=o),placeholder:l(m).size_sqm,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,he),[[f,h.value,void 0,{trim:!0}]])]),e("div",_e,[e("label",ve,[e("span",ge,s(t.$t("room.height"))+" [m] ",1)]),b(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=o=>_.value=o),placeholder:l(m).height_m,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,xe),[[f,_.value,void 0,{trim:!0}]])]),e("div",be,[e("label",fe,[e("span",ye,s(t.$t("room.maxOccupancy")),1)]),b(e("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=o=>v.value=o),placeholder:l(m).max_occupancy,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,we),[[f,v.value,void 0,{trim:!0}]])]),l(R)?(i(),d("button",{key:0,class:"mt-2 btn gray-button font-semibold",onClick:S},s(t.$t("update")),1)):$("",!0)])]),l(B)?(i(),d("div",ke,[e("div",$e,[e("div",je,[l(R)?(i(),G(k,{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"addInstallation",params:{roomId:l(n)}}},{default:C(()=>[y(s(t.$t("installation.add")),1)]),_:1},8,["to"])):$("",!0)])]),e("table",Re,[e("thead",Ie,[e("tr",null,[e("th",Ve,s(t.$t("room.sensor")),1),e("th",Oe,s(t.$t("node.isPublic")),1),e("th",De,s(t.$t("node.installedOn")),1),e("th",Ce,s(t.$t("node.removedOn")),1),e("th",Me,s(t.$t("actions")),1)])]),e("tbody",null,[(i(!0),d(M,null,H(j.value,(o,g)=>(i(),d("tr",{key:o._jv.id,class:Q([g%2==0?"bg-white":"bg-gray-50"])},[e("td",ze,s(o.node.alias),1),e("td",Ne,s(o.is_public),1),e("td",Be,s(O(o.from_timestamp_s)),1),e("td",Fe,s(O(o.to_timestamp_s)),1),e("td",Se,[e("div",Te,[e("div",Ue,[W(k,{class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"installation",params:{installationId:o._jv.id}}},{default:C(()=>[y(s(t.$t("inspect")),1)]),_:2},1032,["to"])]),l(R)?(i(),d("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:I=>t.terminateInstallation(o._jv.id)},s(t.$t("installation.terminate")),9,Ee)):$("",!0)])])],2))),128))])])])):$("",!0)]))],64)}}};export{qe as default};
