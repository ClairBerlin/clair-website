import{o as u,a as k,w as v,g as i,b as e,d as t,X as E,_ as X,Z,ak as J,ai as K,e as O,t as n,aj as ee,W as te,Y as se,D as F,U as ae,u as oe,al as ne,c as b,H as le,G as N,r as ie,f as p,ao as re,b4 as de,F as T,q as M,j as q,n as ce,O as L}from"./vendor.c632a9d3.js";import{b as ue,i as A,d as B}from"./index.ce7b7c95.js";import{a as me}from"./index.36f78768.js";import{s as pe,c as fe,a as x,_ as w,F as ge}from"./TextInput.d734e693.js";import{_ as be}from"./SubmitButton.1f24900a.js";import{_ as D}from"./PrivacyToggle.4481e6af.js";const ve={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},ye=e("span",{class:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"},"\u200B",-1),he={class:"inline-block transform overflow-hidden rounded-md bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle"},_e={class:"absolute top-0 right-0 hidden pt-4 pr-4 sm:block"},xe=e("span",{class:"sr-only"},"Close",-1),we={class:"sm:flex sm:items-start"},$e={class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},ke={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},je={class:"mt-2"},Ie={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},Ce={props:{open:{type:Boolean,required:!0},modalTitle:{type:String,required:!0}},emits:["closeModal","installClicked"],setup(c,{emit:o}){const f=()=>o("closeModal"),l=()=>{o("installClicked"),f()};return(d,m)=>(u(),k(t(se),{as:"template",show:c.open},{default:v(()=>[i(t(te),{as:"div",class:"fixed inset-0 z-10 overflow-y-auto",onClose:f},{default:v(()=>[e("div",ve,[i(t(E),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:v(()=>[i(t(X),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),ye,i(t(E),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:v(()=>[e("div",he,[e("div",_e,[e("button",{type:"button",class:"rounded-sm bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:f},[xe,i(t(Z),{class:"h-6 w-6","aria-hidden":"true"})])]),e("div",we,[e("div",$e,[i(t(J),{class:"h-6 w-6 text-indigo-600","aria-hidden":"true"})]),e("div",ke,[i(t(K),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:v(()=>[O(n(c.modalTitle),1)]),_:1}),e("div",je,[ee(d.$slots,"default")])])]),e("div",Ie,[e("button",{type:"button",class:"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",onClick:l},n(d.$t("installation.installNow")),1),e("button",{type:"button",class:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm",onClick:f},n(d.$t("cancel")),1)])])]),_:3})])]),_:3})]),_:3},8,["show"]))}},Se={props:{sensorAlias:{type:String,default:""},sensorDescription:{type:String,default:""},eui64:{type:String,default:""},sensorId:{type:String,default:""},tradeName:{type:String,default:""},sensorManufacturer:{type:String,default:""},allowEdit:{type:Boolean,default:!1},buttonText:{type:String,required:!0},onSubmit:{type:Function,required:!0}},setup(c){const{t:o}=F();pe({mixed:{required:({label:l})=>l+" "+o("field_required")},string:{max:({label:l,max:d})=>o("field_too_big",{field:l,max:d})}});const f=fe().shape({alias:x().required().max(100).label(o("node.name")),description:x().nullable().label(o("description")),eui:x().nullable().label(o("node.eui")),id:x().nullable().label(o("node.id")),type:x().nullable().label(o("node.type")),manufacturer:x().nullable().label(o("node.manufacturer"))});return(l,d)=>(u(),k(t(ge),{class:"space-y-6",onSubmit:c.onSubmit,"validation-schema":t(f)},{default:v(()=>[i(w,{disabled:!c.allowEdit,value:c.sensorAlias,name:"alias",label:t(o)("node.name")},null,8,["disabled","value","label"]),i(w,{disabled:!c.allowEdit,element:"textarea",value:c.sensorDescription,name:"description",label:`${t(o)("description")} (${t(o)("optional")})`},null,8,["disabled","value","label"]),i(w,{disabled:"",name:"eui",value:c.eui64,label:t(o)("node.eui")},null,8,["value","label"]),i(w,{disabled:"",name:"id",value:c.sensorId,label:t(o)("node.id")},null,8,["value","label"]),i(w,{disabled:"",name:"type",value:c.tradeName,label:t(o)("node.type")},null,8,["value","label"]),i(w,{disabled:"",name:"manufacturer",value:c.sensorManufacturer,label:t(o)("node.manufacturer")},null,8,["value","label"]),i(be,{"allow-submit":c.allowEdit},{default:v(()=>[O(n(l.$t(c.buttonText)),1)]),_:1},8,["allow-submit"])]),_:1},8,["onSubmit","validation-schema"]))}},Ne={key:0,class:""},Te={class:"form-control"},qe={for:"room",class:"block text-sm font-medium text-gray-700"},Le=["value"],Oe={class:"my-2 flex items-center"},Ve={class:"mr-3 text-sm"},Ee={for:"makePublic",class:"font-medium text-gray-700"},Me={key:2},Ae={class:"mt-8 max-w-sm sm:max-w-lg"},Be={class:"rounded-sm bg-white p-6 shadow-md"},De={key:3,class:"text-md mt-8 overflow-hidden rounded-sm bg-white ring-1 ring-gray-300"},Fe={class:"min-w-full divide-y divide-gray-200"},Re={class:"bg-gray-50"},Pe={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},ze={scope:"col",class:"py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},Ue={scope:"col",class:"py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},Ge={scope:"col",class:"hidden py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6 md:table-cell"},Ye={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},He={class:"whitespace-nowrap px-2 py-4 sm:px-6"},Qe={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},We={key:1},Xe={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},Ze={class:"whitespace-nowrap px-2 py-4 text-left sm:px-6"},Je={class:"whitespace-nowrap px-2 py-4 sm:px-6"},Ke={class:"flex flex-col sm:flex-row"},et={class:"flex flex-row"},tt=["onClick"],dt={emits:["changeSubheading"],setup(c,{emit:o}){const f=ae(),l=oe(),d=ne(),{t:m}=F(),$=b(()=>l.getters["nav/isOwner"]),R=b(()=>l.getters["nav/isOrgContextLoading"]),h=b(()=>f.params.sensorId),y=b(()=>l.getters["jv/get"]({_jv:{type:"Node",id:h.value}}));le(()=>{var s;((s=y.value)==null?void 0:s.alias)&&o("changeSubheading",y.value.alias)});const j=b(()=>{const s=l.getters["jv/get"]("Installation",`$[?(@.node._jv.id=="${h.value}")]`);return Object.entries(s).map(([,g])=>g)}),P=b(()=>{var s;return((s=j.value)==null?void 0:s.length)>0}),z=b(()=>ue(j.value)),I=b(()=>l.getters["nav/getRooms"]),U=b(()=>{var s;return((s=I.value)==null?void 0:s.length)>0}),C=N(!1),_=N(I.value[0]),S=N(!1),G=async({alias:s,description:r})=>{let g={_jv:{type:"Node",id:h.value},alias:s,description:r};try{await l.dispatch("jv/patch",[g,{url:`nodes/${h.value}/`}]),d.success(m("node.updateSuccess"))}catch(a){d.error(m("node.updateError")),console.log(a)}},V=async s=>{const r={_jv:{type:"Installation",id:s},to_timestamp_s:L().unix()};try{await l.dispatch("jv/patch",[r,{url:`installations/${s}/`}]),d.success(m("installation.successTerminate"))}catch(g){d.error(m("installation.errorTerminate")),console.log(g)}},Y=async()=>{if(typeof _.value=="undefined"){d.error(m("installation.errorNoTarget"));return}let s={_jv:{type:"Installation",relationships:{room:{data:{type:"Room",id:_.value._jv.id}},node:{data:{type:"Node",id:h.value}}}},from_timestamp_s:L().unix(),is_public:S.value};try{await l.dispatch("jv/post",[s,{url:"installations/"}]),await l.dispatch("jv/get",["installations",{params:{"filter[organization]":f.params.orgId}}],{root:!0}),d.success(m("installation.successCreate")),_.value=void 0}catch(r){d.error(m("installation.errorCreate")),_.value=void 0,console.log(r)}},H=async s=>{let r={_jv:{type:"Installation",relationships:{room:{data:{type:"Room",id:s.room._jv.id}},node:{data:{type:"Node",id:s.node._jv.id}}}},from_timestamp_s:L().unix(),to_timestamp_s:s.to_timestamp_s,is_public:!s.is_public,description:s.description};try{await l.dispatch("jv/post",[r,{url:"installations/"}]),d.success(m("installation.newInstallationCreated"))}catch(g){d.error(m("installation.errorCreatingnewInstallation")),console.log(g)}},Q=async s=>{await V(s._jv.id),await H(s)};return(s,r)=>{const g=ie("router-link");return u(),p(T,null,[t($)&&!t(z)&&t(U)?(u(),p("div",Ne,[e("div",{class:"btn bg-indigo-600 normal-case hover:bg-indigo-700",onClick:r[0]||(r[0]=a=>C.value=!0)},n(s.$t("installation.installNow")),1),i(Ce,{open:C.value,onCloseModal:r[3]||(r[3]=a=>C.value=!1),onInstallClicked:Y,"modal-title":"Installation "+t(m)("of")+" "+t(y).alias},{default:v(()=>[e("div",Te,[e("label",qe,n(s.$t("installation.targetLocation")),1),re(e("select",{id:"location",name:"room","onUpdate:modelValue":r[1]||(r[1]=a=>_.value=a),class:"mt-1 block w-full rounded-sm border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"},[(u(!0),p(T,null,M(t(I),a=>(u(),p("option",{key:a._jv.id,value:a},n(a.name),9,Le))),128))],512),[[de,_.value]])]),e("div",Oe,[e("div",Ve,[e("label",Ee,n(s.$t("installation.makePublic")),1)]),e("div",null,[i(D,{modelValue:S.value,"onUpdate:modelValue":r[2]||(r[2]=a=>S.value=a)},null,8,["modelValue"])])])]),_:1},8,["open","modal-title"])])):q("",!0),t(R)?(u(),k(me,{key:1})):(u(),p("div",Me,[e("div",Ae,[e("div",Be,[i(Se,{"sensor-alias":t(y).alias,"sensor-description":t(y).description,eui64:t(y).eui64,"sensor-id":t(h),"trade-name":t(y).model.trade_name,"sensor-manufacturer":t(y).model.manufacturer,"allow-edit":t($),"button-text":"update","on-submit":G},null,8,["sensor-alias","sensor-description","eui64","sensor-id","trade-name","sensor-manufacturer","allow-edit"])])])])),t(P)?(u(),p("div",De,[e("table",Fe,[e("thead",Re,[e("tr",null,[e("th",Pe,n(s.$t("node.installationLocation")),1),e("th",ze,n(s.$t("installation.isPublic")),1),e("th",Ue,n(s.$t("installation.installedOn")),1),e("th",Ge,n(s.$t("installation.removedOn")),1),e("th",Ye,n(s.$t("actions")),1)])]),e("tbody",null,[(u(!0),p(T,null,M(t(j),(a,W)=>(u(),p("tr",{key:a._jv.id,class:ce([W%2===0?"bg-white":"bg-gray-50"])},[e("td",He,n(a.room.name),1),e("td",Qe,[t($)&&t(A)(a)?(u(),k(D,{key:0,enabled:a.is_public,"on-toggle":()=>Q(a)},null,8,["enabled","on-toggle"])):(u(),p("div",We,n(s.$t(`installation.public.${a.is_public}`)),1))]),e("td",Xe,n(t(B)(a.from_timestamp_s)),1),e("td",Ze,n(t(B)(a.to_timestamp_s)),1),e("td",Je,[e("div",Ke,[e("div",et,[i(g,{class:"gray-button btn-sm my-2 w-max font-semibold",to:{name:"installation",params:{installationId:a._jv.id}}},{default:v(()=>[O(n(s.$t("inspect")),1)]),_:2},1032,["to"])]),t($)&&t(A)(a)?(u(),p("div",{key:0,class:"gray-button btn-sm m-2 mr-0 w-max font-semibold",onClick:st=>V(a._jv.id)},n(s.$t("installation.terminate")),9,tt)):q("",!0)])])],2))),128))])])])):q("",!0)],64)}}};export{dt as default};
