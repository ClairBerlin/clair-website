import{s as q,R as E,q as G,ah as Z,v as m,G as c,S as H,r as J,o as n,c as u,t as s,a as e,ai as h,aj as v,u as l,g as j,e as O,w as R,b as _,F as K,l as P,n as Q,d as U,a6 as W}from"./vendor.2f240eb0.js";const X={key:0},Y={key:1},ee={class:"max-w-sm sm:max-w-lg"},te={class:"text-black m-2 p-4 card ring-1 ring-gray-300 bg-white"},se={class:"form-control"},oe={class:"label"},ae={class:"label-text text-black font-bold"},le=["placeholder"],de={class:"form-control py-4"},ne={class:"label"},ie={class:"label-text text-black font-bold"},re=["placeholder"],ce={class:"form-control"},ue={class:"label"},pe={class:"label-text text-black font-bold"},me=["placeholder"],he={class:"form-control"},ve={class:"label"},_e={class:"label-text text-black font-bold"},xe=["placeholder"],ye={class:"form-control"},be={class:"label"},fe={class:"label-text text-black font-bold"},ge=["placeholder"],we={class:"form-control"},ke={class:"label"},$e={class:"label-text text-black font-bold"},je=["placeholder"],Se={key:0,class:"ring-1 ring-gray-300 rounded-md bg-white text-md overflow-hidden mt-8"},Ve={class:"flex justify-end items-center"},Ie={class:"flex flex-row"},Re={class:"min-w-full divide-y divide-gray-200"},Ce={class:"bg-gray-50"},ze={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Fe={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},Oe=e("sup",null,"2",-1),Ue=_("] "),Be={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"},De={scope:"col",class:"sm:px-6 py-3 text-right text-xs font-medium text-gray-500 tracking-wider hidden md:table-cell"},Ne={scope:"col",class:"px-2 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},Me={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ae={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Le={class:"px-2 sm:px-6 py-4 whitespace-nowrap text-right"},Te={class:"hidden md:table-cell px-2 sm:px-6 py-4 whitespace-nowrap text-right"},qe={class:"px-2 sm:px-6 py-4 whitespace-nowrap"},Ee={class:"flex flex-col sm:flex-row"},Ge={class:"flex flex-row"},Ze=["onClick"],He={key:1,class:"shadow-md mt-4 rounded-md max-w-sm flex items-center bg-yellow-50 border-l-4 border-yellow-400 p-4"},Je={class:"flex"},Ke={class:"flex-shrink-0"},Pe={class:"ml-3"},Ye={setup(Qe){const C=q(),B=E(),i=G(),z=Z(),d=m(()=>C.params.siteId),r=m(()=>i.getters["jv/get"]({_jv:{type:"Site",id:d.value}})),F=m(()=>r.value.address._jv.id),S=c([]),D=m(()=>{var t;return!k.value&&((t=S.value)==null?void 0:t.length)>0}),k=c(!0),N=m(()=>i.getters["authuser/getMembershipByOrgId"](C.params.orgId)),$=m(()=>{var t;return((t=N.value)==null?void 0:t.role)==="O"}),x=c(void 0),y=c(void 0),b=c(void 0),f=c(void 0),g=c(void 0),w=c(void 0),M=async t=>{await i.dispatch("jv/delete",`rooms/${t}`),V()},A=async()=>{let t={_jv:{type:"Site",id:d.value}};x.value&&(t.name=x.value),y&&(t.description=y.value);try{const{_jv:o}=await i.dispatch("jv/patch",[t,{url:`sites/${d.value}/`}]);B.push({name:"site",params:{siteId:d.value}})}catch(o){z.error("Failed to update the site"),console.log(o)}},L=async()=>{let t={_jv:{type:"Address",id:F.value}};b&&(t.street1=b.value),f&&(t.street2=f.value),g&&(t.zip=g.value),w&&(t.city=w.value);try{const{_jv:o}=await i.dispatch("jv/patch",[t,{url:`addresses/${F.value}/`}])}catch(o){z.error("Failed to update the address"),console.log(o)}},T=async()=>{(x.value||y.value)&&A(),(b.value||f.value||g.value||w.value)&&L(),V()},V=async()=>{var p;k.value=!0,typeof((p=r.value)==null?void 0:p.name)=="undefined"&&(console.log(`Site with ID ${d.value} has not been loaded yet; fetching...`),await i.dispatch("jv/get",`sites/${d.value}/`)),console.log(`Fetch related objects for site ${d.value}.`),await i.dispatch("jv/getRelated",`sites/${d.value}`);const t=await i.dispatch("jv/get",`sites/${d.value}/rooms`),o=Object.entries(t);console.log(`Fetched ${o.length} rooms`),S.value=o.map(([a,I])=>I),k.value=!1};return H(async()=>V()),(t,o)=>{const p=J("router-link");return k.value?(n(),u("div",X,s(t.$t("loading...")),1)):(n(),u("div",Y,[e("div",ee,[e("div",te,[e("div",se,[e("label",oe,[e("span",ae,s(t.$t("site.name")),1)]),h(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>x.value=a),placeholder:l(r).name,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,le),[[v,x.value,void 0,{trim:!0}]])]),e("div",de,[e("label",ne,[e("span",ie,s(t.$t("description")),1)]),h(e("textarea",{type:"text","onUpdate:modelValue":o[1]||(o[1]=a=>y.value=a),placeholder:l(r).description,class:"como-focus rounded h-24 text-gray-600"},null,8,re),[[v,y.value,void 0,{trim:!0}]])]),e("div",ce,[e("label",ue,[e("span",pe,s(t.$t("address.street1")),1)]),h(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=a=>b.value=a),placeholder:l(r).address.street1,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,me),[[v,b.value,void 0,{trim:!0}]])]),e("div",he,[e("label",ve,[e("span",_e,s(t.$t("address.street2")),1)]),h(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=a=>f.value=a),placeholder:l(r).address.street2,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,xe),[[v,f.value,void 0,{trim:!0}]])]),e("div",ye,[e("label",be,[e("span",fe,s(t.$t("address.zip")),1)]),h(e("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=a=>g.value=a),placeholder:l(r).address.zip,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,ge),[[v,g.value,void 0,{trim:!0}]])]),e("div",we,[e("label",ke,[e("span",$e,s(t.$t("address.city")),1)]),h(e("input",{type:"text","onUpdate:modelValue":o[5]||(o[5]=a=>w.value=a),placeholder:l(r).address.city,class:"input-bordered como-focus rounded bg-white text-gray-600"},null,8,je),[[v,w.value,void 0,{trim:!0}]])]),l($)?(n(),u("button",{key:0,class:"mt-2 btn gray-button font-semibold",onClick:T},s(t.$t("site.update")),1)):j("",!0)])]),l(D)?(n(),u("div",Se,[e("div",Ve,[e("div",Ie,[l($)?(n(),O(p,{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"addRoom",params:{siteId:l(d)}}},{default:R(()=>[_(s(t.$t("room.add")),1)]),_:1},8,["to"])):j("",!0)])]),e("table",Re,[e("thead",Ce,[e("tr",null,[e("th",ze,s(t.$t("room.name")),1),e("th",Fe,[_(s(t.$t("room.size"))+" [m",1),Oe,Ue]),e("th",Be,s(t.$t("room.height"))+" [m] ",1),e("th",De,s(t.$t("room.maxOccupancy")),1),e("th",Ne,s(t.$t("actions")),1)])]),e("tbody",null,[(n(!0),u(K,null,P(S.value,(a,I)=>(n(),u("tr",{key:a._jv.id,class:Q([I%2==0?"bg-white":"bg-gray-50"])},[e("td",Me,s(a.name),1),e("td",Ae,s(a.size_sqm),1),e("td",Le,s(a.height_m),1),e("td",Te,s(a.max_occupancy),1),e("td",qe,[e("div",Ee,[e("div",Ge,[U(p,{class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",to:{name:"room",params:{roomId:a._jv.id}}},{default:R(()=>[_(s(t.$t("inspect")),1)]),_:2},1032,["to"])]),l($)?(n(),u("div",{key:0,class:"btn-sm m-2 mr-0 gray-button font-semibold w-max",onClick:We=>M(a._jv.id)},s(t.$t("remove")),9,Ze)):j("",!0)])])],2))),128))])])])):(n(),u("div",He,[e("div",Je,[e("div",Ke,[U(l(W),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),e("div",Pe,[_(s(t.$t("site.noRooms"))+". ",1),l($)?(n(),O(p,{key:0,class:"font-medium underline text-yellow-700 hover:text-yellow-600",to:{name:"addRoom",params:{siteId:l(d)}}},{default:R(()=>[_(s(t.$t("room.add"))+".",1)]),_:1},8,["to"])):j("",!0)])])]))]))}}};export{Ye as default};
